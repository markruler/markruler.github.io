<!DOCTYPE html>
<html lang="ko"><head>
  
  <title>Playwright를 사용해서 HTML 페이지를 PDF로 만들기 - 임창수 블로그</title>
  
  
  
  
  
  <meta theme="Hugo Theme Diary(MIT) by Rise Ported from Makito's Journal(MIT).">
  <meta charset="utf-8">
  <meta name="X-UA-Compatible" content="IE=edge">
  <meta name="google-site-verification" content="">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="telephone=no" name="format-detection">
  <meta name="description" content="HTML to PDF">
  <meta name="renderer" content="webkit">
  <meta name="theme-color" content="#ffffff">

  
  
  <meta property="og:title" content="Playwright를 사용해서 HTML 페이지를 PDF로 만들기" />
<meta property="og:description" content="HTML to PDF" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://markruler.github.io/posts/pdf/html-to-pdf/" /><meta property="og:image" content="https://markruler.github.io/images/pdf/htmltopdf.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-12T22:02:00+09:00" />
<meta property="article:modified_time" content="2023-12-12T22:02:00+09:00" /><meta property="og:site_name" content="임창수 블로그" />


  

  
  
  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://markruler.github.io/images/pdf/htmltopdf.png"/>

<meta name="twitter:title" content="Playwright를 사용해서 HTML 페이지를 PDF로 만들기"/>
<meta name="twitter:description" content="HTML to PDF"/>

  

  
  <meta name="google-site-verification" content="60VmMXH5SqMxrPFmaJ27RuE-pn2Yg7hw1BtEkXLmOwc" />
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FFMDWZ27TN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-FFMDWZ27TN');
  </script>

  
  

  <script src="/vendor/js/jquery.min.js" ></script>
  <script src="/vendor/js/popper.min.js" ></script>
  <script src="/vendor/js/bootstrap.min.js" ></script>
  <script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
  <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
  <script src="/vendor/js/vue.min.js" ></script>

  

  
  <link rel="icon" href="https://markruler.github.io/images/favicon.ico">
  
  

  
  
  
  <link rel="stylesheet" href="https://markruler.github.io/scss/dark-mode.min.4c4033ff4494b2f0a0c5e7c899105f5abe76b2f05e54a45b5044a3bf6016c74c.css" integrity="sha256-TEAz/0SUsvCgxefImRBfWr52svBeVKRbUESjv2AWx0w=" media="screen">
  

  <script src="https://markruler.github.io//js/loadCSS.js"></script>
  <script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
  </script>

  

  
  
  <script src="https://markruler.github.io//js/toc.js"></script>
  
  

  

  

  

  

</head>
<body>
  <div id="app"><div ref="sideContainer" class="side-container">

  <a class="a-block nav-head false" href="https://markruler.github.io/">

  <div class="nav-title">
    Im Changsu
  </div>
  
    <div class="nav-subtitle">
      What, Why, How.
    </div>
  
  </a>
  <div class="nav-link-list">
    
    
    
    
    
    
    
    <a class="a-block nav-link-item false" href="/about">
      About
    </a>
    
    
    
    
    
    
    
    
    
    <a class="a-block nav-link-item active" href="/posts">
      Posts
    </a>
    
    
    
    
    
    
    
    <a class="a-block nav-link-item false" href="/categories">
      Categories
    </a>
    
    
    
    
    
    
    
    <a class="a-block nav-link-item false" href="/tags">
      Tags
    </a>
    
    
    
    
    
    
    
    <a class="a-block nav-link-item false" href="/index.xml">
      RSS Feed
    </a>
    
    
  </div>

  <div class="nav-footer">
    


&copy;
	
	Im Changsu 2020 - 2023
	

  </div>

</div><div ref="extraContainer" class="extra-container">
    
    
    
    <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- TOC -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ea%b0%9c%ec%9a%94" onclick="onNavClick(`#개요-nav`)" id="개요-nav">
									개요
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#1%ec%b0%a8-%ec%8b%9c%eb%8f%84-wkhtmltopdf" onclick="onNavClick(`#1차-시도-wkhtmltopdf-nav`)" id="1차-시도-wkhtmltopdf-nav">
									1차 시도: wkhtmltopdf
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2%ec%b0%a8-%ec%8b%9c%eb%8f%84-pyppeteer" onclick="onNavClick(`#2차-시도-pyppeteer-nav`)" id="2차-시도-pyppeteer-nav">
									2차 시도: pyppeteer
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3%ec%b0%a8-%ec%8b%9c%eb%8f%84-microsoftplaywright" onclick="onNavClick(`#3차-시도-microsoftplaywright-nav`)" id="3차-시도-microsoftplaywright-nav">
									3차 시도: microsoft/playwright
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ea%b5%ac%ed%98%84-%ec%8b%9c-%ec%b0%b8%ea%b3%a0-%ec%82%ac%ed%95%ad" onclick="onNavClick(`#구현-시-참고-사항-nav`)" id="구현-시-참고-사항-nav">
									구현 시 참고 사항
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%b0%b8%ec%a1%b0" onclick="onNavClick(`#참조-nav`)" id="참조-nav">
									참조
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#playwright" onclick="onNavClick(`#playwright-nav`)" id="playwright-nav">
									Playwright
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#webkit" onclick="onNavClick(`#webkit-nav`)" id="webkit-nav">
									WebKit
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#chromium" onclick="onNavClick(`#chromium-nav`)" id="chromium-nav">
									Chromium
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Posts
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- TOC -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ea%b0%9c%ec%9a%94" onclick="onNavClick(`#개요-nav`)" id="개요-nav">
									개요
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#1%ec%b0%a8-%ec%8b%9c%eb%8f%84-wkhtmltopdf" onclick="onNavClick(`#1차-시도-wkhtmltopdf-nav`)" id="1차-시도-wkhtmltopdf-nav">
									1차 시도: wkhtmltopdf
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2%ec%b0%a8-%ec%8b%9c%eb%8f%84-pyppeteer" onclick="onNavClick(`#2차-시도-pyppeteer-nav`)" id="2차-시도-pyppeteer-nav">
									2차 시도: pyppeteer
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3%ec%b0%a8-%ec%8b%9c%eb%8f%84-microsoftplaywright" onclick="onNavClick(`#3차-시도-microsoftplaywright-nav`)" id="3차-시도-microsoftplaywright-nav">
									3차 시도: microsoft/playwright
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ea%b5%ac%ed%98%84-%ec%8b%9c-%ec%b0%b8%ea%b3%a0-%ec%82%ac%ed%95%ad" onclick="onNavClick(`#구현-시-참고-사항-nav`)" id="구현-시-참고-사항-nav">
									구현 시 참고 사항
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%b0%b8%ec%a1%b0" onclick="onNavClick(`#참조-nav`)" id="참조-nav">
									참조
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#playwright" onclick="onNavClick(`#playwright-nav`)" id="playwright-nav">
									Playwright
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#webkit" onclick="onNavClick(`#webkit-nav`)" id="webkit-nav">
									WebKit
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#chromium" onclick="onNavClick(`#chromium-nav`)" id="chromium-nav">
									Chromium
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://markruler.github.io/">
            
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://markruler.github.io/">
        <div class="single-column-header-title"></div>
        
        <div class="single-column-header-subtitle">Im Changsu</div>
        

    </a>
</div>

    <div id="content">
<div ref="streamContainer" class="stream-container">
  <div class="post-list-container post-list-container-shadow">
    <div class="post">
      
      
      
      
      

      <div class="post-head-wrapper"  
        
        style="background-image: url('https://markruler.github.io/images/pdf/htmltopdf.png')"  >
        <div class="post-title">
          Playwright를 사용해서 HTML 페이지를 PDF로 만들기
          
          <div class="post-subtitle">
            HTML to PDF
          </div>
          
          <div class="post-meta">
            
            <time itemprop="datePublished">
              2023년 12월 12일 22시 02분
            </time>
            

            
            <i class="material-icons" style="">folder</i>
            <a href="/categories/">[pdf]</a>
            &nbsp;
            

            
            <i class="material-icons" style="">label</i>
            
            <a href="/tags/web">web</a>
            &nbsp;
            
            <a href="/tags/pdf">pdf</a>
            &nbsp;
            
            
            
          </div>
        </div>
      </div>

      <div class="post-body-wrapper">
        
          <div class="post-body" v-pre>
            
            <h1 id="개요">개요</h1>
<p>팀내에서 문서 생성 도구로 <a href="https://pdfmyurl.com/html-to-pdf-api">PDFmyURL</a>과
<a href="https://www.forcs.com/kr/oz-e-form/">OZ e-Form</a>을 사용하고 있다.
보통 이런 외부 솔루션은 테스트 할 때 매우 불편했다.</p>
<p>PDFmyURL은 PDF를 생성하는 2가지 인터페이스가 있다.
하나는 URL을 통해 페이지를 읽어서 PDF를 생성하는 인터페이스고,
하나는 raw HTML, CSS를 직접 전달해서 PDF를 생성하는 인터페이스다.
URL 방식은 PDFmyURL 측 서버(서비스 외부)에서 페이지 조회가 가능해야 하기 때문에,
private 환경에서는 테스트 할 수가 없다.
그래서 해당 기능들은 운영 환경에서 QA 테스트를 해야 하는 불상사가 생긴다.
더 큰 문제는 데이터를 Public으로 공개해야 하기 때문에 문서에 따라 개인 정보 유출 문제를 피해야 했다.</p>
<p>OZ e-Form의 클라이언트 프로그램(OZ e-Form Designer)은 Windows만 지원한다.
그리고 OZ 에이전트와 script를 적극적으로 관리할 인력이 없다.
활용도가 떨어지기 때문에 관심이 적을 수 밖에 없었다.</p>
<p>이러한 제약 조건들을 견디며 힘겹게 쓰고 있었는데,
PDFmyURL에 동시에 많은 요청을 보내는 팀원의 실수로 PDFmyURL 측에서 우리쪽 서버를 차단해버렸다.
그래서 PDFmyURL을 이용하는 서비스가 반나절동안 중단되었다.
문의를 남겨도 해외 서비스라 대응이 느렸고 언제 해결될지 기약이 없어서,
결국 다른 계정으로 라이센스를 추가 발급받아 해결했다.</p>
<p>내부에서 관리 가능한 HTML to PDF 변환 도구가 간절하다고 느낀 시기였다.</p>
<h1 id="1차-시도-wkhtmltopdf">1차 시도: wkhtmltopdf</h1>
<p>이런 프로그램을 제작해 본 경험자가 없어서 막연히 ChatGPT에게 물어봤다.
가장 먼저 답변해준 방법은 <a href="https://wkhtmltopdf.org/">wkhtmltopdf</a> 였다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># 해당 도구는 한글을 출력하기 위해 한글 폰트를 별도 설치해야 했다.</span>
apt-get -y install fonts-nanum wkhtmltopdf
</code></pre></div><p>빠르게 시작하기 위해 Python의 <code>pdfkit</code>과
오픈 소스 PDF 변환 툴인 <code>wkhtmltopdf</code>를 사용해서 Flask 앱을 만들었다.
하지만 기존 출력물(크롬에서 <a href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#printing">window.print()</a>)과
달리 PDF 출력물을 보면 CSS가 틀어지는 부분이 너무 많았다.</p>
<p>리뷰하는 과정에서 확인해보니 문서를 읽지 않은 내 잘못이었다.
해당 홈페이지 첫 문장부터 <code>Qt WebKit rendering engine</code> 이라고 설명한다.
<code>wk</code>는 WebKit의 약자였고, Qt WebKit을 기반으로 변환하다보니
Chromium 기반으로 작성되어 있는 HTML이 그대로 보일 리 없었다.</p>
<ul>
<li><strong><a href="https://en.wikipedia.org/wiki/Comparison_of_browser_engines">Comparison of browser engines</a></strong></li>
</ul>
<h1 id="2차-시도-pyppeteer">2차 시도: pyppeteer</h1>
<p>기존에 Python으로 작성된 코드를 재사용하려고 Javascript 기반의 <a href="https://github.com/puppeteer/puppeteer">puppeteer</a>
대신 python 기반의 <a href="https://github.com/pyppeteer/pyppeteer">pyppeteer</a>을 사용했다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Ubuntu 22.04에서 google-chrome 명령어 설치</span>
apt-get update <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    <span style="color:#ff79c6">&amp;&amp;</span> apt-get install -y wget gnupg <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    <span style="color:#ff79c6">&amp;&amp;</span> wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | gpg --dearmor -o /usr/share/keyrings/googlechrome-linux-keyring.gpg <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    <span style="color:#ff79c6">&amp;&amp;</span> sh -c <span style="color:#f1fa8c">&#39;echo &#34;deb [arch=amd64 signed-by=/usr/share/keyrings/googlechrome-linux-keyring.gpg] http://dl.google.com/linux/chrome/deb/ stable main&#34; &gt;&gt; /etc/apt/sources.list.d/google.list&#39;</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    <span style="color:#ff79c6">&amp;&amp;</span> apt-get update <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    <span style="color:#ff79c6">&amp;&amp;</span> apt-get install -y google-chrome-stable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-khmeros fonts-kacst fonts-freefont-ttf libxss1 <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>      --no-install-recommends <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    <span style="color:#ff79c6">&amp;&amp;</span> rm -rf /var/lib/apt/lists/* <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    <span style="color:#ff79c6">&amp;&amp;</span> groupadd -r pptruser <span style="color:#ff79c6">&amp;&amp;</span> useradd -rm -g pptruser -G audio,video pptruser
</code></pre></div><p><code>google-chrome</code>을 headless 모드로 실행해서 프린트하면
출력물이 브라우저 프린트(<code>window.print()</code>)와 동일하게 나왔다.
또한 private 환경에서도 출력이 가능해졌다.</p>
<p>HTML 작성 시 브라우저 프린트 기능으로 계속 확인하면서(<code>Ctrl + P</code>)
작업할 수 있기 때문에 WebKit이 아닌 Chrome(Blank 엔진)을 선택했다.
팀원 모두가 Safari를 쓰면 모르겠는데 모두 Edge 아니면 Chrome을 사용하고 있었다.</p>
<h1 id="3차-시도-microsoftplaywright">3차 시도: microsoft/playwright</h1>
<p>URL이 아닌 Raw HTML, Raw CSS Content를 전달해서 PDF 출력하는 기능도 지원되어야 한다.
p<strong>y</strong>ppeteer에선 HTML Content를 렌더링 할 때 Load 되는 것을 기다리지 않아서
이미지 렌더링(img src, background url 등)이 되지 않았다.</p>
<ul>
<li><code>setContent()</code> 시 <code>waitUntil</code> 옵션을 p<strong>u</strong>ppeteer만 지원하고 있다.
<ul>
<li><a href="https://github.com/puppeteer/puppeteer/issues/907#issuecomment-472334126">page.setContent(html, {waitUntil: &lsquo;networkidle&rsquo;}); · Issue #907 · puppeteer/puppeteer</a></li>
<li><a href="https://github.com/miyakogi/pyppeteer/issues/211">setContent extra options · Issue #211 · miyakogi/pyppeteer</a></li>
</ul>
</li>
</ul>
<p>반면 <a href="https://github.com/microsoft/playwright-python">playwright</a>는 해당 기능들을
모두 지원하면서, Javascript는 물론 Python도 지원했다.
Content로 PDF 출력하는 기능도 지원하기 위해
<a href="https://github.com/microsoft/playwright-python">microsoft의 playwright</a>로 변경하기로 결정했다.
<a href="https://playwright.dev/docs/puppeteer">puppeteer와 인터페이스를 유사하게 만들었기</a>
때문에 변경하는 데에 많은 리소스가 들진 않았다.</p>
<p>다음은 간단히 실행 가능한 토막 코드다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-python" data-lang="python"><span style="color:#6272a4"># python3 -m pip install playwright</span>
<span style="color:#6272a4"># python3 -m playwright install chromium  # Download to $HOME/.cache/ms-playwright/</span>
<span style="color:#6272a4"># python3 main.py</span>
<span style="color:#ff79c6">import</span> logging
<span style="color:#ff79c6">import</span> asyncio

<span style="color:#ff79c6">from</span> playwright.async_api <span style="color:#ff79c6">import</span> async_playwright, Playwright, PlaywrightContextManager, Browser, BrowserContext

<span style="color:#ff79c6">async</span> <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">core_file</span>():
    playwright_context_manager: PlaywrightContextManager <span style="color:#ff79c6">=</span> async_playwright()

    <span style="color:#6272a4"># https://playwright.dev/python/docs/api/class-playwright</span>
    playwright: Playwright <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> playwright_context_manager<span style="color:#ff79c6">.</span>start()

    <span style="color:#6272a4"># https://playwright.dev/python/docs/api/class-browsertype#browser-type-launch</span>
    browser: Browser <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> playwright<span style="color:#ff79c6">.</span>chromium<span style="color:#ff79c6">.</span>launch(
        headless<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>,
        timeout<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10_000</span>,  <span style="color:#6272a4"># (ms)</span>
        args<span style="color:#ff79c6">=</span>[
            <span style="color:#6272a4"># https://peter.sh/experiments/chromium-command-line-switches/</span>
            <span style="color:#f1fa8c">&#34;--no-sandbox&#34;</span>,
            <span style="color:#f1fa8c">&#34;--single-process&#34;</span>,
            <span style="color:#f1fa8c">&#34;--disable-dev-shm-usage&#34;</span>,
            <span style="color:#f1fa8c">&#34;--disable-gpu&#34;</span>,
            <span style="color:#f1fa8c">&#34;--no-zygote&#34;</span>,
        ],
        <span style="color:#6272a4"># avoid &#34;signal only works in main thread of the main interpreter&#34;</span>
        handle_sigint<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>,
        handle_sigterm<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>,
        handle_sighup<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>,
    )

    <span style="color:#6272a4"># https://playwright.dev/python/docs/api/class-browser#browser-new-context</span>
    logging<span style="color:#ff79c6">.</span>debug(<span style="color:#f1fa8c">&#39;new_context:new_page&#39;</span>)
    context: BrowserContext <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> browser<span style="color:#ff79c6">.</span>new_context()
    page <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> context<span style="color:#ff79c6">.</span>new_page()

    <span style="color:#6272a4"># https://playwright.dev/python/docs/api/class-page#page-goto</span>
    logging<span style="color:#ff79c6">.</span>debug(<span style="color:#f1fa8c">&#39;set_content&#39;</span>)
    <span style="color:#ff79c6">await</span> page<span style="color:#ff79c6">.</span>set_content(
        html<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;&lt;div&gt;&lt;span&gt;Test&lt;/span&gt; Text&lt;/div&gt;&#39;</span>,
        timeout<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10_000</span>,
        <span style="color:#6272a4"># load로 해야 img.src가 로드됨.</span>
        wait_until<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;load&#39;</span>  <span style="color:#6272a4"># domcontentloaded, load, networkidle</span>
    )

    logging<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#39;add_style_tag&#39;</span>)
    <span style="color:#ff79c6">await</span> page<span style="color:#ff79c6">.</span>add_style_tag(
        content<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;span{color:red;}&#39;</span>
    )

    <span style="color:#6272a4"># https://playwright.dev/python/docs/api/class-page#page-pdf</span>
    logging<span style="color:#ff79c6">.</span>debug(<span style="color:#f1fa8c">&#39;Generate PDF&#39;</span>)
    _pdf <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> page<span style="color:#ff79c6">.</span>pdf(
        <span style="color:#8be9fd;font-style:italic">format</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;A4&#39;</span>,
        landscape<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>,
        print_background<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>,
        display_header_footer<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>,
        margin<span style="color:#ff79c6">=</span>{
            <span style="color:#f1fa8c">&#39;top&#39;</span>: <span style="color:#f1fa8c">&#39;10mm&#39;</span>,
            <span style="color:#f1fa8c">&#39;bottom&#39;</span>: <span style="color:#f1fa8c">&#39;10mm&#39;</span>,
            <span style="color:#f1fa8c">&#39;left&#39;</span>: <span style="color:#f1fa8c">&#39;10mm&#39;</span>,
            <span style="color:#f1fa8c">&#39;right&#39;</span>: <span style="color:#f1fa8c">&#39;10mm&#39;</span>,
        }
    )

    <span style="color:#8be9fd;font-style:italic">print</span>(_pdf)

    <span style="color:#ff79c6">await</span> context<span style="color:#ff79c6">.</span>close()  <span style="color:#6272a4"># don&#39;t forget to close the context, or it will create a core.{number} file.</span>
    <span style="color:#ff79c6">await</span> browser<span style="color:#ff79c6">.</span>close()
    <span style="color:#ff79c6">await</span> playwright<span style="color:#ff79c6">.</span>stop()


<span style="color:#6272a4"># python3 main.py</span>
<span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;__main__&#39;</span>:
    asyncio<span style="color:#ff79c6">.</span>run(core_file())
</code></pre></div><h1 id="구현-시-참고-사항">구현 시 참고 사항</h1>
<ul>
<li>CSS attribute 중 <code>page-break-***</code> 를 사용하면 페이지를 원하는 부분에서 분리할 수 있다.
<ul>
<li><code>page-break-after: always;</code> 해당 Element 이후에 내용이 있더라도 페이지를 분리한다.</li>
<li><code>page-break-after: avoid;</code> 해당 Element 이후에 페이지는 분리하지 않는다. 이후 내용이 페이지를 넘친다면 페이지 분리되긴 한다.</li>
</ul>
</li>
<li>PDF 생성 후 응답되기까지 PDFmyURL만큼 걸린다.
<ul>
<li>약 2~5초 (평균 약 4초)</li>
</ul>
</li>
<li>Server to Server로 요청 시 Spring Boot에서 FeignClient로
<a href="https://wildeveloperetrain.tistory.com/304">x-www-form-urlencoded</a>
데이터를 보내려면 <code>MultiValueMap&lt;String, String&gt;</code>을 사용해야 한다.</li>
<li>OZ report는 별도의 스크립트와 프로그램을 사용하고 있기 때문에 옮기는데 비용이 꽤 들어서 아직 못 하고 있다.</li>
</ul>
<h1 id="참조">참조</h1>
<h2 id="playwright"><strong>Playwright</strong></h2>
<ul>
<li><a href="https://playwright.dev/python/">공식 문서</a></li>
<li><a href="https://github.com/microsoft/playwright-python">GitHub</a></li>
<li><a href="https://devocean.sk.com/blog/techBoardDetail.do?ID=165090">웹 테스트 자동화</a>가 목적인 라이브러리임.</li>
</ul>
<h2 id="webkit"><strong>WebKit</strong></h2>
<ul>
<li><a href="https://wkhtmltopdf.org/">wkhtmltopdf</a></li>
</ul>
<h2 id="chromium"><strong>Chromium</strong></h2>
<ul>
<li><a href="https://developer.chrome.com/articles/new-headless/">Chrome’s Headless mode gets an upgrade: introducing &ndash;headless=new | Chromium | Chrome for Developers</a></li>
</ul>

            
            
            
            
          </div>
        </div>


        <nav class="post-pagination">
          
          <a class="newer-posts">
            다음 글<br>없음
          </a>
          

          
          <a class="older-posts" href="https://markruler.github.io/posts/db/oracle-dbms-session-diagnosis/">
            이전 글<br>오라클 DBMS SE2 세션 사후 진단
          </a>
          
        </nav>
        
        <div class="post-comment-wrapper">
          
          







        </div>

        
        





<section class="social-share">
  <ul class="share-icons">
    
    
    <li>
      <a href="https://twitter.com/intent/tweet?hashtags=markruler,dev&amp;url=https%3a%2f%2fmarkruler.github.io%2fposts%2fpdf%2fhtml-to-pdf%2f&amp;text=Playwright%eb%a5%bc%20%ec%82%ac%ec%9a%a9%ed%95%b4%ec%84%9c%20HTML%20%ed%8e%98%ec%9d%b4%ec%a7%80%eb%a5%bc%20PDF%eb%a1%9c%20%eb%a7%8c%eb%93%a4%ea%b8%b0" target="_blank" rel="noopener" aria-label="Share on Twitter" class="share-btn twitter">
        
<svg xmlns:xlink="http://www.w3.org/1999/xlink" id="twitter" viewBox="0 0 48 48" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">bg</title>
    <circle cx="24" cy="24" fill="#1CB7EB" r="24" style="pointer-events:inherit" id="svg_1"></circle>
    <path d="M36.8,15.4C35.9,15.9 34.8,16.2 33.8,16.3C34.9,15.6 35.7,14.5 36.1,13.2C35.1,13.8 34,14.3 32.7,14.6C31.7,13.5 30.4,12.8 28.9,12.8C26,12.8 23.6,15.3 23.6,18.5C23.6,18.9 23.6,19.4 23.7,19.8C19.3,19.6 15.4,17.3 12.8,13.9C12.3,14.7 12.1,15.7 12.1,16.8C12.1,18.8 13,20.5 14.4,21.5C13.5,21.5 12.7,21.2 12,20.8C12,20.8 12,20.9 12,20.9C12,23.6 13.8,25.9 16.2,26.5C15.8,26.6 15.3,26.7 14.8,26.7C14.5,26.7 14.1,26.7 13.8,26.6C14.5,28.9 16.4,30.5 18.7,30.5C16.9,32 14.6,32.9 12.2,32.9C11.8,32.9 11.4,32.9 10.9,32.8C13.2,34.4 16,35.4 19,35.4C28.7,35.4 34,26.8 34,19.3C34,19.1 34,18.8 34,18.6C35.2,17.6 36.1,16.6 36.8,15.4z" fill="#FFFFFF" style="pointer-events:inherit" id="svg_4"></path>
  </g>
</svg>
        <p>Twitter</p>
      </a>
    </li>
    

    
    
    <li>
      <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmarkruler.github.io%2fposts%2fpdf%2fhtml-to-pdf%2f" target="_blank" rel="noopener" aria-label="Share on Facebook" class="share-btn facebook">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 48 48" id="facebook" version="1.1" viewBox="0 0 48 48" xml:space="preserve">
  <circle cx="24" cy="24" fill="#4E71A8" r="24" />
  <path d="M29.9,19.5h-4v-2.6c0-1,0.7-1.2,1.1-1.2c0.5,0,2.8,0,2.8,0v-4.4l-3.9,0c-4.4,0-5.3,3.3-5.3,5.3v2.9h-2.5V24  h2.5c0,5.8,0,12.7,0,12.7h5.3c0,0,0-7,0-12.7h3.6L29.9,19.5z" fill="#FFFFFF" />
</svg>
        <p>Facebook</p>
        </a>
    </li>
    

    
    
    <li>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmarkruler.github.io%2fposts%2fpdf%2fhtml-to-pdf%2f&amp;source=https%3a%2f%2fmarkruler.github.io%2fposts%2fpdf%2fhtml-to-pdf%2f&amp;title=Playwright%eb%a5%bc%20%ec%82%ac%ec%9a%a9%ed%95%b4%ec%84%9c%20HTML%20%ed%8e%98%ec%9d%b4%ec%a7%80%eb%a5%bc%20PDF%eb%a1%9c%20%eb%a7%8c%eb%93%a4%ea%b8%b0&amp;summary=Playwright%eb%a5%bc%20%ec%82%ac%ec%9a%a9%ed%95%b4%ec%84%9c%20HTML%20%ed%8e%98%ec%9d%b4%ec%a7%80%eb%a5%bc%20PDF%eb%a1%9c%20%eb%a7%8c%eb%93%a4%ea%b8%b0" target="_blank" rel="noopener" aria-label="Share on LinkedIn" class="share-btn linkedin">
        <svg xmlns:xlink="http://www.w3.org/1999/xlink" id="linkedin" viewBox="0 0 128 128" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:none">
    <title style="pointer-events:inherit">background</title>
    <rect x="-1" y="-1" width="582" height="402" id="canvas_background" fill="none" style="pointer-events:inherit"></rect>
  </g>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">Layer 1</title>
    <circle cx="64" cy="64" fill="#0076B4" r="64" id="svg_2" stroke-dasharray="none"></circle>
    <path d="M44.119,95.934L29.184,95.934L29.184,47.93L44.119,47.93L44.119,95.934zM36.656,41.371C31.864,41.371 28,37.495 28,32.718C28,27.943 31.864,24.066 36.656,24.066C41.427,24.066 45.302,27.942 45.302,32.718C45.303,37.495 41.428,41.371 36.656,41.371zM100,95.934L85.081,95.934L85.081,72.59C85.081,67.024 84.984,59.862 77.329,59.862C69.564,59.862 68.381,65.927 68.381,72.192L68.381,95.934L53.479,95.934L53.479,47.93L67.78,47.93L67.78,54.492L67.984,54.492C69.974,50.718 74.841,46.739 82.101,46.739C97.206,46.739 99.998,56.678 99.998,69.607L100,95.934L100,95.934z" fill="#FFFFFF" style="pointer-events:inherit" id="svg_4"></path>
  </g>
</svg>
          <p>LinkedIn</p>
        </a>
    </li>
    

    
    

    
    
    <li>
      <a href="mailto:?subject= - Playwright%eb%a5%bc%20%ec%82%ac%ec%9a%a9%ed%95%b4%ec%84%9c%20HTML%20%ed%8e%98%ec%9d%b4%ec%a7%80%eb%a5%bc%20PDF%eb%a1%9c%20%eb%a7%8c%eb%93%a4%ea%b8%b0.&amp;body=Playwright%eb%a5%bc%20%ec%82%ac%ec%9a%a9%ed%95%b4%ec%84%9c%20HTML%20%ed%8e%98%ec%9d%b4%ec%a7%80%eb%a5%bc%20PDF%eb%a1%9c%20%eb%a7%8c%eb%93%a4%ea%b8%b0%2c%20by%20%0aHTML%20to%20PDF%0a%0ahttps%3a%2f%2fmarkruler.github.io%2fposts%2fpdf%2fhtml-to-pdf%2f%0a" target="_blank" class="share-btn email">
        <svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" id="email" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:none">
    <title style="pointer-events:inherit">background</title>
    <rect x="-1" y="-1" width="582" height="402" id="canvas_background" fill="none" style="pointer-events:inherit"></rect>
  </g>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">Layer 1</title>
    <path d="M16,0C7.163,0 0,7.163 0,16C0,24.836 7.163,32 16,32S32,24.836 32,16C32,7.163 24.837,0 16,0z" fill="#333333" style="pointer-events:inherit" id="svg_2"></path>
    <polygon fill="#FFFFFF" points="6.518,21.815 11.707,15.291 6.518,12.119   " style="pointer-events:inherit" id="svg_4"></polygon>
    <polygon fill="#FFFFFF" points="19.5,15.746 15.989,17.908 12.472,15.758 7.11,22.5 24.867,22.5   " style="pointer-events:inherit" id="svg_5"></polygon>
    <polygon fill="#FFFFFF" points="15.988,16.864 25.482,11.017 25.482,9.5 6.518,9.5 6.518,11.076   " style="pointer-events:inherit" id="svg_6"></polygon>
    <polygon fill="#FFFFFF" points="20.263,15.276 25.482,21.843 25.482,12.062   " style="pointer-events:inherit" id="svg_7"></polygon>
  </g>
</svg>
        <p>Email</p>
      </a>
    </li>
  </ul>
</section>


      </div>
    </div>
  </div>
  
    </div><div id="single-column-footer">


&copy;
	
	Im Changsu 2020 - 2023
	
</div>
  </div>
  <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            }
    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
                this.toggleDarkMode();
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});
</script>

<script src="https://markruler.github.io//js/journal.js"></script>
</body>

</html>