<!DOCTYPE html>
<html lang="ko"><head>

<title>
  
  임창수
  
  | IP로 지리적 위치(Geolocation) 찾기
  
  
</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="CDN에서 위치 정보를 얻는 방법">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">
<link rel="manifest" href="/manifest.json">



<meta property="og:url" content="https://markruler.github.io/posts/network/ip-geolocation/">
  <meta property="og:site_name" content="임창수">
  <meta property="og:title" content="IP로 지리적 위치(Geolocation) 찾기">
  <meta property="og:description" content="CDN에서 위치 정보를 얻는 방법">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-29T22:38:00+09:00">
    <meta property="article:modified_time" content="2024-08-29T22:38:00+09:00">
    <meta property="article:tag" content="Network">
    <meta property="article:tag" content="Ip">
    <meta property="article:tag" content="Geolocation">
    <meta property="og:image" content="https://markruler.github.io/images/network/ip-geolocation/ip-geolocation.webp">






  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://markruler.github.io/images/network/ip-geolocation/ip-geolocation.webp">
  <meta name="twitter:title" content="IP로 지리적 위치(Geolocation) 찾기">
  <meta name="twitter:description" content="CDN에서 위치 정보를 얻는 방법">











  




<link rel="icon" href="https://markruler.github.io/images/favicon.ico">




      <script defer src="/js/toc.js"></script>
    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="/scss/dark-mode.min.6664f0e1282ed64845cd248c3143bf78740b6cf9635c2c161dcb0df80b344a86.css" integrity="sha256-ZmTw4Sgu1khFzSSMMUO/eHQLbPljXCwWHcsN&#43;As0SoY=" media="screen">




















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Posts
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 목차 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ed%98%84%ec%83%81" class="nav-현상">
									현상
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%9b%90%ec%9d%b8" class="nav-원인">
									원인
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ed%95%b4%ea%b2%b0" class="nav-해결">
									해결
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%ea%b5%ac%ed%98%84-%eb%b0%a9%eb%b2%95-spring-framework" class="nav-구현-방법-spring-framework">
									구현 방법 (Spring Framework)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%eb%8d%a4%ec%9c%bc%eb%a1%9c-%ec%96%bb%ec%9d%80-%ec%a0%95%ed%99%95%ec%84%b1" class="nav-덤으로-얻은-정확성">
									덤으로 얻은 정확성?
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%ec%a0%9c%eb%a1%9c-%ed%8a%b8%eb%9f%ac%ec%8a%a4%ed%8a%b8" class="nav-제로-트러스트">
									제로 트러스트!
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ec%b0%b8%ec%a1%b0" class="nav-참조">
									참조
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            📜
        </button>
        <a id="navTitle" class="navbar-brand" href="https://markruler.github.io/">
            임창수
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            🌙
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
    v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <button
        class="read-random-mobile"
        data-target-prefix="/posts">
        Navigate to Random Post
    </button>
    <a href="https://markruler.github.io/">
        <div class="single-column-header-title">임창수</div>
        
        <div class="single-column-header-subtitle">What, Why, How.</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    IP로 지리적 위치(Geolocation) 찾기
                    
                    <div class="post-subtitle">
                        CDN에서 위치 정보를 얻는 방법
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-08-29 22:38
                        </time>
                        

                        
                            <a href="/categories/blog">[blog]</a>
                            &nbsp;
                        

                        
                            
                                <a href="/tags/network">network</a>
                                &nbsp;
                            
                                <a href="/tags/ip">ip</a>
                                &nbsp;
                            
                                <a href="/tags/geolocation">geolocation</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="현상">현상</h1>
<p>약 10ms 응답속도가 예상되는 API에 500~700ms의 응답속도가 발생했습니다.</p>
<h1 id="원인">원인</h1>
<p><img src="/images/network/ip-geolocation/ipapi-latency.png" alt="ipapi Latency"></p>
<p>해당 API에서는 국가별로 다른 정책을 적용하기 위해 IP로 국가 정보<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>를 조회하는 기능이 가장 먼저 수행됩니다.
국가 정보의 출처는 ipapi라는 유료 API 서비스와 IPInfoDB라는 무료 서비스입니다.
대략적인 코드는 다음과 같습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Cacheable(value = CacheName.IPAPI_COUNTRY_CODE, key = <span style="color:#87ceeb">&#34;#ipAddress&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f00">public</span> Geolocation <span style="color:#ff0">findIsoCountryCode</span>(<span style="color:#f00">final</span> String ipAddress) {
</span></span><span style="display:flex;"><span>    <span style="color:#f00">if</span> (isPrivate(ipAddress)) {
</span></span><span style="display:flex;"><span>        <span style="color:#f00">return</span> Geolocation.korea();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f00">var</span> ipapi = ipapiFeignClient.findGeolocationByIpAddress(ipAddress, IPAPI_ACCESS_KEY);
</span></span><span style="display:flex;"><span>    <span style="color:#f00">if</span> (ipapi != <span style="color:#f00">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#f00">return</span> Geolocation.from(ipapi);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f00">var</span> ipInfoDB = ipInfoDBFeignClient.findGeolocationByIpAddress(ipAddress, IPINFODB_ACCESS_KEY);
</span></span><span style="display:flex;"><span>    <span style="color:#f00">if</span> (ipInfoDB != <span style="color:#f00">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#f00">return</span> Geolocation.from(ipInfoDB);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f00">return</span> Geolocation.korea();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>문제는 API가 아무리 빨라도 해당 IP Geolocation 서비스에서 응답받는 데에 평균 약 500ms 정도 소요되었다는 것입니다.</p>
<h1 id="해결">해결</h1>
<p>이를 해결하기 위해 캐싱도 해봤지만 처음 접속한 IP의 경우 조회가 발생할 수 밖에 없었고,
결정적으로 이렇게 처음 접속한 IP가 매우 많았다(약 130만 건/월)는 것입니다.</p>
<p>이 문제는 생각보다 간단하게 해결할 수 있었습니다.
CDN을 사용할 경우 CDN에서 제공하는 헤더에서 위치 정보를 얻을 수 있는데,
이 헤더를 활용하면 별도 서비스를 조회할 필요가 없기 때문에 응답 속도를 줄일 수 있었습니다.</p>
<ul>
<li><strong>Akamai</strong>는 EdgeScape 기능을 활성화하면 <code>X-Akamai-Edgescape</code> 헤더로 확인할 수 있습니다.<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></li>
<li><strong>CloudFlare</strong>는 관련 기능을 활성화 했을 경우 <code>CF-IPCountry</code> 헤더로 확인할 수 있다고 합니다.<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></li>
<li><strong>Amazon CloudFront</strong>는 <code>CloudFront-Viewer-Country</code> 헤더로 확인할 수 있다고 합니다.<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></li>
</ul>
<h2 id="구현-방법-spring-framework">구현 방법 (Spring Framework)</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Target(ElementType.PARAMETER)
</span></span><span style="display:flex;"><span>@Retention(RetentionPolicy.RUNTIME)
</span></span><span style="display:flex;"><span><span style="color:#f00">public</span> @interface GeoLocation {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@RequiredArgsConstructor
</span></span><span style="display:flex;"><span><span style="color:#f00">public</span> <span style="color:#f00">class</span> GeoLocationAspect {
</span></span><span style="display:flex;"><span>    <span style="color:#f00">private</span> <span style="color:#f00">final</span> HttpServletRequest request;
</span></span><span style="display:flex;"><span>    <span style="color:#f00">private</span> <span style="color:#f00">final</span> GeoLocationService service;
</span></span><span style="display:flex;"><span>    <span style="color:#0f0">/**
</span></span></span><span style="display:flex;"><span><span style="color:#0f0">     * &lt;code&gt;@annotation(GeoLocation)&lt;/code&gt;와 같은 방식은
</span></span></span><span style="display:flex;"><span><span style="color:#0f0">     * &lt;code&gt;@GeoLocation&lt;/code&gt; 애노테이션이 붙은 메서드에만 적용됩니다.
</span></span></span><span style="display:flex;"><span><span style="color:#0f0">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#87ceeb">&#34;@annotation(org.springframework.web.bind.annotation.GetMapping) || &#34;</span>
</span></span><span style="display:flex;"><span>            + <span style="color:#87ceeb">&#34;@annotation(org.springframework.web.bind.annotation.PostMapping) || &#34;</span>
</span></span><span style="display:flex;"><span>            + <span style="color:#87ceeb">&#34;@annotation(org.springframework.web.bind.annotation.RequestMapping)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f00">public</span> <span style="color:#ee82ee">void</span> <span style="color:#ff0">mappingAnnotations</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    @Around(<span style="color:#87ceeb">&#34;mappingAnnotations()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f00">public</span> Object <span style="color:#ff0">injectGeoLocation</span>(ProceedingJoinPoint joinPoint) <span style="color:#f00">throws</span> Throwable {
</span></span><span style="display:flex;"><span>        MethodSignature signature = (MethodSignature) joinPoint.getSignature();
</span></span><span style="display:flex;"><span>        Method method = signature.getMethod();
</span></span><span style="display:flex;"><span>        Object[] args = joinPoint.getArgs();
</span></span><span style="display:flex;"><span>        Parameter[] parameters = method.getParameters();
</span></span><span style="display:flex;"><span>        <span style="color:#f00">for</span> (<span style="color:#ee82ee">int</span> i = 0; i &lt; parameters.length; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#f00">if</span> (parameters[i].isAnnotationPresent(GeoLocation.class)) {
</span></span><span style="display:flex;"><span>                Location geoLocation = getGeoLocationFromRequest();
</span></span><span style="display:flex;"><span>                <span style="color:#0f0">// @GeoLocation 파라미터에 위치 정보를 주입합니다.</span>
</span></span><span style="display:flex;"><span>                args[i] = geoLocation;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#0f0">// 메서드 호출을 진행합니다.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f00">return</span> joinPoint.proceed(args);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#0f0">/**
</span></span></span><span style="display:flex;"><span><span style="color:#0f0">     * CDN, ipapi, IPInfoDB 순으로 접속 국가 코드 조회
</span></span></span><span style="display:flex;"><span><span style="color:#0f0">     *
</span></span></span><span style="display:flex;"><span><span style="color:#0f0">     * @return Geolocation
</span></span></span><span style="display:flex;"><span><span style="color:#0f0">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f00">private</span> Location <span style="color:#ff0">getGeoLocationFromRequest</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#f00">return</span> service.findLocation(request);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@GetMapping
</span></span><span style="display:flex;"><span><span style="color:#f00">public</span> Response&lt;Items&gt; <span style="color:#ff0">control</span>(
</span></span><span style="display:flex;"><span>        @GeoLocation <span style="color:#f00">final</span> Location location,
</span></span><span style="display:flex;"><span>        @AuthenticationPrincipal <span style="color:#f00">final</span> PrincipalDetailDto user,
</span></span><span style="display:flex;"><span>        @RequestBody @Valid <span style="color:#f00">final</span> RequestDto requestDto
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>    log.debug(location);
</span></span><span style="display:flex;"><span>    <span style="color:#f00">return</span> success(service.process(requestDto));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="덤으로-얻은-정확성">덤으로 얻은 정확성?</h1>
<p>추가로 해결되었던 점은 정확성이었습니다.</p>
<p>현재 서비스에서 아제르바이잔 이용자에게만 적용되는 정책이 있었는데 실제 이용자에게서 본인에게만 적용되지 않는다고 클레임이 들어왔습니다.
확인해보니 ipapi에서 정확하지 않은 Geolocation 정보가 응답되고 있었습니다.
이는 ipapi만의 문제가 아니었습니다.</p>
<p><img src="/images/network/ip-geolocation/iplocation-inaccuracy.png" alt="iplocation inaccuracy"></p>
<p><em>네덜란드이거나 아제르바이잔이거나 | <a href="https://iplocation.io/">iplocation.io</a></em></p>
<p><img src="/images/network/ip-geolocation/ipapi-inaccuracy.png" alt="ipapi inaccuracy"></p>
<p><em>파나마 공화국이었던 | <a href="https://ipapi.com/">ipapi</a></em></p>
<p>우리는 2024년 4월 12일 ipapi에 문의했지만 데이터 공급자(Data Provider)에 의해 업데이트 될 것이라는 답변만 받았었습니다.
하지만 4개월이 지난 현재(8월 29일)에도 업데이트되지 않았습니다.</p>
<p>그렇다면 CDN Provider는 믿을 수 있을까요?
저희 서비스에서 사용하는 Akamai 문서를 보면 신뢰도가 높아보였습니다.</p>
<blockquote>
<p>&ldquo;How Does Akamai Know the Location of an IP Address?&rdquo; | &lt;Akamai EdgeScape Methodology&gt; 발췌</p>
<p>(Akamai Control &gt; Download Center &gt; Core Features &gt; EdgeScape)</p>
<ul>
<li><strong>Public Registry Data</strong>
We obtain geographic information for the IP blocks registered with the various public Internet registries and ISPs. This information forms the base layer of the database.
As this is public information registered for blocks of addresses, we trust this data the least when analyzing the different sources of data.</li>
<li><strong>Hostname Pattern Matching</strong>
Many machines on the Internet (routers, servers, POPs, and even end-user machines) have a hostname (reverse DNS entry) associated with them.
In many cases, these hostnames contain geographic information hinting at the location of that machine.
By analyzing hostnames from different networks and ISPs, we have built up, and continue to add to,
a database of patterns that allows us to extract the geographic information embedded in these names.
It also allows us to extrapolate the location of other machines on the Internet,
by giving us data points that can be used when tracing to other IPs.</li>
<li><strong>Known Locations</strong>
Akamai has an extensive network of servers distributed across the globe, which act as data points when determining the location of machines nearby.
We also have relationships with networks and customers all over the world.
In order to serve their traffic efficiently, we sometimes get useful information from them regarding the location of their servers,
which we can also use as data points in creating our geographic database.</li>
<li><strong>Active Measurement</strong>
Due to Akamai&rsquo;s extensive customer base, we have the unique ability to know at any given time a large fraction of &ldquo;active&rdquo; end-user IPs on the net.
We then perform traceroutes and pings from various points on our globally distributed network to these active IPs.
We also perform a reduced number of traces and pings to IPs in the non end-user space, such as routers and infrastructure servers.<br>
<br>
When analyzing the traces, we use the location of machines determined using the Hostname pattern matching described above
and the geographic information from the Internet registries to determine the location of the IP traced to.
In addition, we use the latency information contained within the trace and the latency information gathered from pinging routers,
along with the limitations imposed by speed-of-light bounds,
in order to weed out bad data and increase the probability of the location we choose being correct.</li>
</ul></blockquote>
<h2 id="제로-트러스트">제로 트러스트!</h2>
<p>하지만 하루만에 문제가 발생했습니다.
간헐적으로 한국에서 접속한 사용자가 미국에서 접속한 것으로 전달되었습니다.</p>
<p>확인해보니 Akamai에서 전달하는 <code>True-Client-IP</code> 헤더는 실제 한국 사용자 IP였고,
<code>X-Akamai-EdgeScape</code> 헤더에는 미국(country_code=US),
<code>X-Forwarded-For</code> 헤더<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>는 Akamai 엣지 서버의 IP가 전달되고 있었습니다.
이 경우 <code>True-Client-IP</code>와 <code>X-Forwarded-For</code> 헤더가 달랐습니다.
그래서 <strong><code>True-Client-IP</code>와 <code>X-Forwarded-For</code> 헤더가 가리키는 IP가 서로 다를 경우에는 다른 서비스에서 Geolocation을 조회하고 캐싱하도록 설정했습니다.</strong>
(CDN -&gt; ipapi -&gt; IPInfoDB 순)</p>
<p>추가로 Apache에서 <code>RemoteIPHeader X-Forwarded-For</code> 설정이 있으면
프록시 서버들의 IP는 모두 빠지고 Client IP만 남습니다.<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>
그래서 해당 설정을 제거했습니다.</p>
<p><em>다만 이 설정을 변경하면 IP를 활용하는 비즈니스 로직에 영향을 줄 수 있으니 영향도를 고려해야 합니다.</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>&lt;VirtualHost *:443&gt;
</span></span><span style="display:flex;"><span>    ServerName www.example.com
</span></span><span style="display:flex;"><span>    ProxyRequests Off
</span></span><span style="display:flex;"><span>    ProxyVia Off
</span></span><span style="display:flex;"><span>    ProxyPreserveHost On
</span></span><span style="display:flex;"><span>    # RemoteIPHeader X-Forwarded-For
</span></span><span style="display:flex;"><span>    ProxyAddHeaders On
</span></span><span style="display:flex;"><span>&lt;/VirtualHost&gt;
</span></span></code></pre></div><h1 id="참조">참조</h1>
<ul>
<li>True-Client-IP 헤더
<ul>
<li><a href="https://techdocs.akamai.com/property-mgr/docs/origin-server#true-client-ip-header">Akamai | <code>True-Client-IP</code> 설정</a></li>
<li><a href="https://developers.cloudflare.com/network/true-client-ip-header/">Cloudflare | <code>True-Client-IP</code> 설정</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/example-function-add-true-client-ip-header.html">AWS CloudFront | <code>True-Client-IP</code> 헤더 추가하기</a></li>
</ul>
</li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>조회하는 정보는 <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">국가 코드 2자리(ISO 3166-1 alpha-2)</a>입니다.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://techdocs.akamai.com/property-mgr/docs/content-tgting">Content Targeting (EdgeScape)</a> | Akamai&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://developers.cloudflare.com/network/ip-geolocation/">IP geolocation</a> | Cloudflare&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p><a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/adding-cloudfront-headers.html">Add CloudFront request headers</a> | Amazon CloudFront&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For">X-Forwarded-For</a> | mdn web docs&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p><a href="https://httpd.apache.org/docs/current/mod/mod_remoteip.html#remoteipheader">Apache Module mod_remoteip</a> | Apache&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">최종 수정: 2024-08-29</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/os/swap-memory/">
			다음글<br>일상에서의 스왑 메모리 (Swap Memory)
                </a>
                
                
                
                <a class="older-posts" href="/posts/web/traceparent-datadog/">
			이전글<br>Traceparent 헤더로 클라이언트부터 서버까지 추적하기
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












            </div>

            





<section class="social-share">
  <ul class="share-icons">
    
    
    <li>
      <a href="https://twitter.com/intent/tweet?hashtags=markruler,dev&amp;url=https%3a%2f%2fmarkruler.github.io%2fposts%2fnetwork%2fip-geolocation%2f&amp;text=IP%eb%a1%9c%20%ec%a7%80%eb%a6%ac%ec%a0%81%20%ec%9c%84%ec%b9%98%28Geolocation%29%20%ec%b0%be%ea%b8%b0" target="_blank" rel="noopener" aria-label="Share on Twitter" class="share-btn twitter">
        <svg xmlns:xlink="http://www.w3.org/1999/xlink" id="twitter" viewBox="0 0 48 48" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">bg</title>
    <circle cx="24" cy="24" fill="#1CB7EB" r="24" style="pointer-events:inherit" id="svg_1"></circle>
    <path d="M36.8,15.4C35.9,15.9 34.8,16.2 33.8,16.3C34.9,15.6 35.7,14.5 36.1,13.2C35.1,13.8 34,14.3 32.7,14.6C31.7,13.5 30.4,12.8 28.9,12.8C26,12.8 23.6,15.3 23.6,18.5C23.6,18.9 23.6,19.4 23.7,19.8C19.3,19.6 15.4,17.3 12.8,13.9C12.3,14.7 12.1,15.7 12.1,16.8C12.1,18.8 13,20.5 14.4,21.5C13.5,21.5 12.7,21.2 12,20.8C12,20.8 12,20.9 12,20.9C12,23.6 13.8,25.9 16.2,26.5C15.8,26.6 15.3,26.7 14.8,26.7C14.5,26.7 14.1,26.7 13.8,26.6C14.5,28.9 16.4,30.5 18.7,30.5C16.9,32 14.6,32.9 12.2,32.9C11.8,32.9 11.4,32.9 10.9,32.8C13.2,34.4 16,35.4 19,35.4C28.7,35.4 34,26.8 34,19.3C34,19.1 34,18.8 34,18.6C35.2,17.6 36.1,16.6 36.8,15.4z" fill="#FFFFFF" style="pointer-events:inherit" id="svg_4"></path>
  </g>
</svg>
        <p>Twitter</p>
      </a>
    </li>
    

    
    
    <li>
      <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmarkruler.github.io%2fposts%2fnetwork%2fip-geolocation%2f" target="_blank" rel="noopener" aria-label="Share on Facebook" class="share-btn facebook">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 48 48" id="facebook" version="1.1" viewBox="0 0 48 48" xml:space="preserve">
  <circle cx="24" cy="24" fill="#4E71A8" r="24" />
  <path d="M29.9,19.5h-4v-2.6c0-1,0.7-1.2,1.1-1.2c0.5,0,2.8,0,2.8,0v-4.4l-3.9,0c-4.4,0-5.3,3.3-5.3,5.3v2.9h-2.5V24  h2.5c0,5.8,0,12.7,0,12.7h5.3c0,0,0-7,0-12.7h3.6L29.9,19.5z" fill="#FFFFFF" />
</svg>
        <p>Facebook</p>
        </a>
    </li>
    

    
    

    
    

    
    
    <li>
      <a href="mailto:?subject=%ec%9e%84%ec%b0%bd%ec%88%98 - IP%eb%a1%9c%20%ec%a7%80%eb%a6%ac%ec%a0%81%20%ec%9c%84%ec%b9%98%28Geolocation%29%20%ec%b0%be%ea%b8%b0.&amp;body=IP%eb%a1%9c%20%ec%a7%80%eb%a6%ac%ec%a0%81%20%ec%9c%84%ec%b9%98%28Geolocation%29%20%ec%b0%be%ea%b8%b0%2c%20by%20%ec%9e%84%ec%b0%bd%ec%88%98%0aCDN%ec%97%90%ec%84%9c%20%ec%9c%84%ec%b9%98%20%ec%a0%95%eb%b3%b4%eb%a5%bc%20%ec%96%bb%eb%8a%94%20%eb%b0%a9%eb%b2%95%0a%0ahttps%3a%2f%2fmarkruler.github.io%2fposts%2fnetwork%2fip-geolocation%2f%0a" target="_blank" class="share-btn email">
        <svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" id="email" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:none">
    <title style="pointer-events:inherit">background</title>
    <rect x="-1" y="-1" width="582" height="402" id="canvas_background" fill="none" style="pointer-events:inherit"></rect>
  </g>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">Layer 1</title>
    <path d="M16,0C7.163,0 0,7.163 0,16C0,24.836 7.163,32 16,32S32,24.836 32,16C32,7.163 24.837,0 16,0z" fill="#333333" style="pointer-events:inherit" id="svg_2"></path>
    <polygon fill="#FFFFFF" points="6.518,21.815 11.707,15.291 6.518,12.119   " style="pointer-events:inherit" id="svg_4"></polygon>
    <polygon fill="#FFFFFF" points="19.5,15.746 15.989,17.908 12.472,15.758 7.11,22.5 24.867,22.5   " style="pointer-events:inherit" id="svg_5"></polygon>
    <polygon fill="#FFFFFF" points="15.988,16.864 25.482,11.017 25.482,9.5 6.518,9.5 6.518,11.076   " style="pointer-events:inherit" id="svg_6"></polygon>
    <polygon fill="#FFFFFF" points="20.263,15.276 25.482,21.843 25.482,12.062   " style="pointer-events:inherit" id="svg_7"></polygon>
  </g>
</svg>
        <p>Email</p>
      </a>
    </li>
  </ul>
</section>


        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://markruler.github.io/">
    
        <div class="nav-title">
            임창수
        </div>
        
        <div class="nav-subtitle">
            What, Why, How.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Posts
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
        <div
            class="read-random a-block nav-link-item false"
            data-target-prefix="/posts">
            Navigate to Random Post
        </div>
    </div>

    <div class="nav-footer">
        


Hugo Theme <a style="color: #0054B8; text-decoration: underline;" href="https://github.com/amazingrise/hugo-theme-diary">Diary</a>
by <a style="color: #0054B8; text-decoration: underline;" href="https://risehere.net/">Rise</a>
<br>
Ported from <a style="color: #0054B8; text-decoration: underline;" href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s
<a style="color: #0054B8; text-decoration: underline;" href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Im Changsu | Since 2020
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 목차 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ed%98%84%ec%83%81" class="nav-현상">
									현상
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%9b%90%ec%9d%b8" class="nav-원인">
									원인
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ed%95%b4%ea%b2%b0" class="nav-해결">
									해결
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%ea%b5%ac%ed%98%84-%eb%b0%a9%eb%b2%95-spring-framework" class="nav-구현-방법-spring-framework">
									구현 방법 (Spring Framework)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%eb%8d%a4%ec%9c%bc%eb%a1%9c-%ec%96%bb%ec%9d%80-%ec%a0%95%ed%99%95%ec%84%b1" class="nav-덤으로-얻은-정확성">
									덤으로 얻은 정확성?
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%ec%a0%9c%eb%a1%9c-%ed%8a%b8%eb%9f%ac%ec%8a%a4%ed%8a%b8" class="nav-제로-트러스트">
									제로 트러스트!
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ec%b0%b8%ec%a1%b0" class="nav-참조">
									참조
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            🔝
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="pagination-action-icon" id="darkModeToggleIcon">
                🌙
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">


Hugo Theme <a style="color: #0054B8; text-decoration: underline;" href="https://github.com/amazingrise/hugo-theme-diary">Diary</a>
by <a style="color: #0054B8; text-decoration: underline;" href="https://risehere.net/">Rise</a>
<br>
Ported from <a style="color: #0054B8; text-decoration: underline;" href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s
<a style="color: #0054B8; text-decoration: underline;" href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Im Changsu | Since 2020
	
</div>
            </div>
    
    <script defer src="/js/journal.js"></script><script defer src="/js/read-random.js"></script>

    <script>
        
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/js/sw.js')
            .then(registration => {
              console.log('Service Worker registered with scope:', registration.scope);
            })
            .catch(error => {
              console.log('Service Worker registration failed:', error);
            });
        }
      </script>
    </body>
</html>
