<!DOCTYPE html>
<html lang="ko"><head>
  
  <title>JVM 모니터링 - 임창수 블로그</title>
  
  
  
  
  
  <meta theme="Hugo Theme Diary(MIT) by Rise Ported from Makito's Journal(MIT).">
  <meta charset="utf-8">
  <meta name="X-UA-Compatible" content="IE=edge">
  <meta name="google-site-verification" content="">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="telephone=no" name="format-detection">
  <meta name="description" content="이게 왜 죽지..?">
  <meta name="renderer" content="webkit">
  <meta name="theme-color" content="#ffffff">

  
  
  <meta property="og:title" content="JVM 모니터링" />
<meta property="og:description" content="이게 왜 죽지..?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://markruler.github.io/posts/java/jvm-monitoring/" /><meta property="og:image" content="https://markruler.github.io/images/java/jvm-monitoring/visualgc-with-visualvm.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-23T00:09:00+09:00" />
<meta property="article:modified_time" content="2022-05-23T00:09:00+09:00" /><meta property="og:site_name" content="임창수 블로그" />


  

  
  
  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://markruler.github.io/images/java/jvm-monitoring/visualgc-with-visualvm.png"/>

<meta name="twitter:title" content="JVM 모니터링"/>
<meta name="twitter:description" content="이게 왜 죽지..?"/>

  

  
  <meta name="google-site-verification" content="60VmMXH5SqMxrPFmaJ27RuE-pn2Yg7hw1BtEkXLmOwc" />
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FFMDWZ27TN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-FFMDWZ27TN');
  </script>

  
  

  <script src="/vendor/js/jquery.min.js" ></script>
  <script src="/vendor/js/popper.min.js" ></script>
  <script src="/vendor/js/bootstrap.min.js" ></script>
  <script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
  <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
  <script src="/vendor/js/vue.min.js" ></script>

  

  
  <link rel="icon" href="https://markruler.github.io/images/favicon.ico">
  
  

  
  
  
  <link rel="stylesheet" href="https://markruler.github.io/scss/dark-mode.min.4c4033ff4494b2f0a0c5e7c899105f5abe76b2f05e54a45b5044a3bf6016c74c.css" integrity="sha256-TEAz/0SUsvCgxefImRBfWr52svBeVKRbUESjv2AWx0w=" media="screen">
  

  <script src="https://markruler.github.io//js/loadCSS.js"></script>
  <script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
  </script>

  

  
  
  <script src="https://markruler.github.io//js/toc.js"></script>
  
  

  

  

  

  

</head>
<body>
  <div id="app"><div ref="sideContainer" class="side-container">

  <a class="a-block nav-head false" href="https://markruler.github.io/">

  <div class="nav-title">
    Im Changsu
  </div>
  
    <div class="nav-subtitle">
      What, Why, How.
    </div>
  
  </a>
  <div class="nav-link-list">
    
    
    
    
    
    
    
    <a class="a-block nav-link-item false" href="/about">
      About
    </a>
    
    
    
    
    
    
    
    
    
    <a class="a-block nav-link-item active" href="/posts">
      Posts
    </a>
    
    
    
    
    
    
    
    <a class="a-block nav-link-item false" href="/categories">
      Categories
    </a>
    
    
    
    
    
    
    
    <a class="a-block nav-link-item false" href="/tags">
      Tags
    </a>
    
    
    
    
    
    
    
    <a class="a-block nav-link-item false" href="/index.xml">
      RSS Feed
    </a>
    
    
  </div>

  <div class="nav-footer">
    


&copy;
	
	Im Changsu 2020 - 2022
	

  </div>

</div><div ref="extraContainer" class="extra-container">
    
    
    
    <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- TOC -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#thread-dump" onclick="onNavClick(`#thread-dump-nav`)" id="thread-dump-nav">
									Thread Dump
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#daemon-thread" onclick="onNavClick(`#daemon-thread-nav`)" id="daemon-thread-nav">
									Daemon Thread
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tool" onclick="onNavClick(`#tool-nav`)" id="tool-nav">
									Tool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#jstack" onclick="onNavClick(`#jstack-nav`)" id="jstack-nav">
									jstack
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#visualvm" onclick="onNavClick(`#visualvm-nav`)" id="visualvm-nav">
									VisualVM
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#heap-dump" onclick="onNavClick(`#heap-dump-nav`)" id="heap-dump-nav">
									Heap Dump
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#outofmemoryerror" onclick="onNavClick(`#outofmemoryerror-nav`)" id="outofmemoryerror-nav">
									OutOfMemoryError
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tool-1" onclick="onNavClick(`#tool-1-nav`)" id="tool-1-nav">
									Tool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#eclipse-memory-analyzer-mat" onclick="onNavClick(`#eclipse-memory-analyzer-mat-nav`)" id="eclipse-memory-analyzer-mat-nav">
									Eclipse Memory Analyzer (MAT)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#visualvm-1" onclick="onNavClick(`#visualvm-1-nav`)" id="visualvm-1-nav">
									VisualVM
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#gc-monitoring" onclick="onNavClick(`#gc-monitoring-nav`)" id="gc-monitoring-nav">
									GC Monitoring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#tool-2" onclick="onNavClick(`#tool-2-nav`)" id="tool-2-nav">
									Tool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#jstat" onclick="onNavClick(`#jstat-nav`)" id="jstat-nav">
									jstat
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#visual-gc" onclick="onNavClick(`#visual-gc-nav`)" id="visual-gc-nav">
									Visual GC
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ed%95%a8%ea%bb%98-%ec%82%ac%ec%9a%a9%ed%95%98%eb%8a%94-%eb%8f%84%ea%b5%ac%eb%93%a4" onclick="onNavClick(`#함께-사용하는-도구들-nav`)" id="함께-사용하는-도구들-nav">
									함께 사용하는 도구들
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#jdk-tools" onclick="onNavClick(`#jdk-tools-nav`)" id="jdk-tools-nav">
									JDK Tools
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#datadog" onclick="onNavClick(`#datadog-nav`)" id="datadog-nav">
									Datadog
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%9d%b4-%ec%99%b8%ec%9d%98-%eb%8f%84%ea%b5%ac%eb%93%a4" onclick="onNavClick(`#이-외의-도구들-nav`)" id="이-외의-도구들-nav">
									이 외의 도구들
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%eb%8d%94-%ec%9d%bd%ec%9d%84-%ea%b1%b0%eb%a6%ac" onclick="onNavClick(`#더-읽을-거리-nav`)" id="더-읽을-거리-nav">
									더 읽을 거리
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#thread-stack" onclick="onNavClick(`#thread-stack-nav`)" id="thread-stack-nav">
									Thread Stack
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#heap-memory" onclick="onNavClick(`#heap-memory-nav`)" id="heap-memory-nav">
									Heap Memory
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#garbage-collection" onclick="onNavClick(`#garbage-collection-nav`)" id="garbage-collection-nav">
									Garbage Collection
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ea%b8%b0%ed%83%80" onclick="onNavClick(`#기타-nav`)" id="기타-nav">
									기타
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Posts
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- TOC -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#thread-dump" onclick="onNavClick(`#thread-dump-nav`)" id="thread-dump-nav">
									Thread Dump
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#daemon-thread" onclick="onNavClick(`#daemon-thread-nav`)" id="daemon-thread-nav">
									Daemon Thread
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tool" onclick="onNavClick(`#tool-nav`)" id="tool-nav">
									Tool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#jstack" onclick="onNavClick(`#jstack-nav`)" id="jstack-nav">
									jstack
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#visualvm" onclick="onNavClick(`#visualvm-nav`)" id="visualvm-nav">
									VisualVM
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#heap-dump" onclick="onNavClick(`#heap-dump-nav`)" id="heap-dump-nav">
									Heap Dump
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#outofmemoryerror" onclick="onNavClick(`#outofmemoryerror-nav`)" id="outofmemoryerror-nav">
									OutOfMemoryError
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tool-1" onclick="onNavClick(`#tool-1-nav`)" id="tool-1-nav">
									Tool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#eclipse-memory-analyzer-mat" onclick="onNavClick(`#eclipse-memory-analyzer-mat-nav`)" id="eclipse-memory-analyzer-mat-nav">
									Eclipse Memory Analyzer (MAT)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#visualvm-1" onclick="onNavClick(`#visualvm-1-nav`)" id="visualvm-1-nav">
									VisualVM
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#gc-monitoring" onclick="onNavClick(`#gc-monitoring-nav`)" id="gc-monitoring-nav">
									GC Monitoring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#tool-2" onclick="onNavClick(`#tool-2-nav`)" id="tool-2-nav">
									Tool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#jstat" onclick="onNavClick(`#jstat-nav`)" id="jstat-nav">
									jstat
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#visual-gc" onclick="onNavClick(`#visual-gc-nav`)" id="visual-gc-nav">
									Visual GC
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ed%95%a8%ea%bb%98-%ec%82%ac%ec%9a%a9%ed%95%98%eb%8a%94-%eb%8f%84%ea%b5%ac%eb%93%a4" onclick="onNavClick(`#함께-사용하는-도구들-nav`)" id="함께-사용하는-도구들-nav">
									함께 사용하는 도구들
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#jdk-tools" onclick="onNavClick(`#jdk-tools-nav`)" id="jdk-tools-nav">
									JDK Tools
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#datadog" onclick="onNavClick(`#datadog-nav`)" id="datadog-nav">
									Datadog
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%9d%b4-%ec%99%b8%ec%9d%98-%eb%8f%84%ea%b5%ac%eb%93%a4" onclick="onNavClick(`#이-외의-도구들-nav`)" id="이-외의-도구들-nav">
									이 외의 도구들
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%eb%8d%94-%ec%9d%bd%ec%9d%84-%ea%b1%b0%eb%a6%ac" onclick="onNavClick(`#더-읽을-거리-nav`)" id="더-읽을-거리-nav">
									더 읽을 거리
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#thread-stack" onclick="onNavClick(`#thread-stack-nav`)" id="thread-stack-nav">
									Thread Stack
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#heap-memory" onclick="onNavClick(`#heap-memory-nav`)" id="heap-memory-nav">
									Heap Memory
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#garbage-collection" onclick="onNavClick(`#garbage-collection-nav`)" id="garbage-collection-nav">
									Garbage Collection
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ea%b8%b0%ed%83%80" onclick="onNavClick(`#기타-nav`)" id="기타-nav">
									기타
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://markruler.github.io/">
            
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://markruler.github.io/">
        <div class="single-column-header-title"></div>
        
        <div class="single-column-header-subtitle">Im Changsu</div>
        

    </a>
</div>

    <div id="content">
<div ref="streamContainer" class="stream-container">
  <div class="post-list-container post-list-container-shadow">
    <div class="post">
      
      
      
      
      

      <div class="post-head-wrapper"  
        
        style="background-image: url('https://markruler.github.io/images/java/jvm-monitoring/visualgc-with-visualvm.png')"  >
        <div class="post-title">
          JVM 모니터링
          
          <div class="post-subtitle">
            이게 왜 죽지..?
          </div>
          
          <div class="post-meta">
            
            <time itemprop="datePublished">
              2022년 05월 23일 00시 09분
            </time>
            

            
            <i class="material-icons" style="">folder</i>
            <a href="/categories/">[java monitoring]</a>
            &nbsp;
            

            
            <i class="material-icons" style="">label</i>
            
            <a href="/tags/java">java</a>
            &nbsp;
            
            <a href="/tags/spring">spring</a>
            &nbsp;
            
            <a href="/tags/tomcat">tomcat</a>
            &nbsp;
            
            <a href="/tags/monitoring">monitoring</a>
            &nbsp;
            
            
            
          </div>
        </div>
      </div>

      <div class="post-body-wrapper">
        
          <div class="post-body" v-pre>
            
            <blockquote>
<p><a href="/posts/java/java-timeout-monitoring/">모니터링과 타임아웃의 중요성</a>은 아무리 강조해도 지나치지 않는다.
최근 회사에서 아주 느린 API(약 15초)를 발견했는데 분명 매일 트래픽이 발생하는데도 2년동안 방치되고 있었다.
이런 레거시는 유지 보수할 일이 없다면 개발팀에서도 확인하기 어렵다.
사용자가 리포팅해주길 기대하는 것보다 모니터링 도구를 통해 파악하는 것이 좋다.
심지어 굉장히 간단한 문제여서 파악하고 수정하는 데에 1시간도 안걸렸지만 약 15초 걸리던 API를 100ms까지 줄였다.</p>
</blockquote>
<p>먼저 알아두면 좋은 명령어가 있다.
<code>jps</code>는 JVM Process Status를 출력하는 명령어로
현재 머신에서 실행중인 JVM의 PID나 실행 옵션을 확인할 때 유용하다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">&gt; jps -v
<span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">PID</span><span style="color:#f1fa8c">}</span> Bootstrap -Djava...
</code></pre></div><h1 id="thread-dump">Thread Dump</h1>
<blockquote>
<p>A thread dump is a snapshot of the state of all threads that are part of the process.
(<a href="https://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/geninfo/diagnos/using_threaddumps.html">Oracle Docs</a>)</p>
</blockquote>
<p>쓰레드 덤프(Thread Dump)란 모든 쓰레드 상태의 스냅샷이다.</p>
<p><img src="/images/java/jvm-monitoring/java-thread-state-machine.png" alt="java-thread-state-machine"></p>
<p><em><a href="https://www.uml-diagrams.org/java-thread-uml-state-machine-diagram-example.html">Java Thread States and Life Cycle</a></em></p>
<p>쓰레드 덤프에 메서드 콜 스택 정보를 가진 스택 프레임(Stack Frame)은 없다.</p>
<p><img src="/images/java/jvm-monitoring/debugging-in-intellij.png" alt="Debugging in IntelliJ"></p>
<p><em>IntelliJ에서 디버깅하면 볼 수 있는 스택 프레임</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">Thread1   Thread2   Thread3
+-------+ +-------+ +-------+
|       | |       | |       |
|       | |       | | frame |
|       | |       | | frame |
| frame | |       | | frame |
| frame | | frame | | frame |
+-------+ +-------+ +-------+
</code></pre></div><h2 id="daemon-thread">Daemon Thread</h2>
<ul>
<li>Daemon Thread
<ul>
<li><code>thread.setDaemon(true)</code></li>
<li>Daemon Thread는 JVM 종료 시 자동으로 강제 종료한다.</li>
<li>언제든지 죽어도 상관없는 작업에 사용한다.</li>
<li>Garbage Collector, JMX</li>
</ul>
</li>
<li>Non-Daemon Thread
<ul>
<li><code>thread.setDaemon(false)</code></li>
<li>Non-Daemon Thread가 실행 중인 경우 JVM은 종료되지 않는다.</li>
<li>기본적으로 개발자가 새로 생성하는 쓰레드는 Non-Daemon Thread이다.</li>
<li>메인 쓰레드(Main Thread)도 Non-Daemon Thread다.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#6272a4">// java.lang.Thread
</span><span style="color:#6272a4"></span><span style="color:#6272a4">/* Whether or not the thread is a daemon thread. */</span>
<span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> daemon <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
</code></pre></div><h2 id="tool">Tool</h2>
<p>나는 주로 쓰레드 간 교착 현상(deadlock)이나
단일 쓰레드의 병목 현상이 의심될 때 사용한다.
하지만 NAVER D2에 올라온 글 &lsquo;<a href="https://d2.naver.com/helloworld/10963">스레드 덤프 분석하기</a>&lsquo;를 보면
이 외의 다양한 상황에서도 쓰레드 덤프를 확인해 볼 수 있다.
쓰레드 덤프 분석이 처음이라면 해당 글을 정독해보자.</p>
<h3 id="jstack">jstack</h3>
<p>쓰레드 스택(Java Thread Stack)을 확인할 수 있는 CLI 도구다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">&gt; jstack -l <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">PID</span><span style="color:#f1fa8c">}</span> &gt; thread_dump.txt
</code></pre></div><h3 id="visualvm">VisualVM</h3>
<p>VisualVM을 사용하면 실시간으로 쓰레드 스택의 상태를 확인할 수 있다.</p>
<p><img src="/images/java/jvm-monitoring/visualvm-tomcat-threads.png" alt="visualvm-tomcat-threads"></p>
<p><em>VisualVM에서 확인한 Thread Stack</em></p>
<h1 id="heap-dump">Heap Dump</h1>
<blockquote>
<p>A heap dump is a snapshot of all the objects in the Java Virtual Machine (JVM) heap at a certain point in time.
(<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/visualvm/heapdump.html">Oracle Docs</a>)</p>
</blockquote>
<p>힙 덤프(Heap Dump)란 JVM 힙의 모든 Object를 담은 스냅샷이다.</p>
<h2 id="outofmemoryerror">OutOfMemoryError</h2>
<p>JVM 실행 시 아래 옵션을 추가하면 <code>OutOfMemoryError</code> 발생으로 JVM이 종료될 때 힙 덤프를 생성한다.</p>
<ul>
<li><code>-XX:HeapDumpPath</code>를 생략하면 Java Process를 실행시킨 곳에 <code>java_pid&lt;pid&gt;.hprof</code> 형태로 파일이 생성된다.
<blockquote>
<p>By default the heap dump is created in a file called java_pid.hprof in the working directory of the VM. - <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/clopts001.html">Oracle Docs</a></p>
</blockquote>
</li>
<li><code>-XX:+PrintClassHistogramAfterFullGC</code>, <code>-XX:+PrintClassHistogramBeforeFullGC</code> 등의 옵션으로
Full GC 전후의 메모리 상태를 간략히 덤프할 수 있다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">-XX:+HeapDumpOnOutOfMemoryError <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-XX:HeapDumpPath<span style="color:#ff79c6">=</span>jvm.hprof
</code></pre></div><h2 id="tool-1">Tool</h2>
<p><code>OutOfMemoryError</code>가 발생한 게 아니라면 <code>jmap</code>을 사용해서 힙 덤프를 확인할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># jmap -dump:format=b,file=/path/app.hprof ${PID}</span>
jmap -dump:file<span style="color:#ff79c6">=</span>/path/app.hprof <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">PID</span><span style="color:#f1fa8c">}</span>
Dumping heap to /path/app.hprof ...
Heap dump file created

&gt; file /path/app.hprof
app.hprof: Java HPROF dump, created Tue May <span style="color:#bd93f9">17</span> 01:15:39 <span style="color:#bd93f9">2022</span>
</code></pre></div><h3 id="eclipse-memory-analyzer-mat">Eclipse Memory Analyzer (MAT)</h3>
<p><a href="https://www.eclipse.org/mat/">MAT</a>는 힙 덤프를 분석할 수 있게 도와주는 프로그램이다.</p>
<ul>
<li>JDK를 찾지 못하는 경우 아래와 같이 옵션을 추가한다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># ${MAT_HOME}/MemoryAnalyzer.ini</span>
-vm
<span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">JAVA_HOME</span><span style="color:#f1fa8c">}</span>/bin

<span style="color:#6272a4"># -vmargs 보다 위에 추가해야 한다.</span>
-vmargs
...
</code></pre></div><p>기본 Heap Size가 1024m이다. Heap Dump 파일이 이보다 큰 경우 Parsing할 때 아래와 같은 에러가 발생한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">An internal error occurred during:
    <span style="color:#f1fa8c">&#34;Parsing heap dump from &#39;/path/java_pid1234.hprof&#39;&#34;</span>.
Java heap space
</code></pre></div><p>설정 파일에 JVM 옵션을 추가하면 확인할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># ${MAT_HOME}/MemoryAnalyzer.ini</span>
-vmargs
<span style="color:#6272a4">#-Xmx1024m</span>
-Xms6g
-Xmx6g
</code></pre></div><h3 id="visualvm-1">VisualVM</h3>
<p><a href="https://visualvm.github.io/download.html">VisualVM</a>은 애플리케이션을 <strong>실시간으로 분석</strong>하는 데 주로 사용한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># etc/visualvm.conf</span>
<span style="color:#8be9fd;font-style:italic">visualvm_jdkhome</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$JAVA_HOME</span><span style="color:#f1fa8c">&#34;</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">&gt; ./bin/visualvm
</code></pre></div><p>아래 기능으로 힙 덤프를 간략히 확인할 수도 있다.
하지만 기능이 다양한 <a href="#eclipse-memory-analyzer-mat">MAT</a>가 있기 때문에
VisualVM은 실시간으로 확인하는 용도로 사용한다.</p>
<ul>
<li><code>File &gt; Load &gt; *.hprof</code></li>
</ul>
<p><img src="/images/java/jvm-monitoring/visualvm-heap-dump.png" alt="visualvm-heap-dump"></p>
<p><em>VisuamVM에서 확인한 Heap Dump</em></p>
<p>Remote로 연결하기 위해서는 WAS에 JMX 설정이 필요하다.</p>
<ul>
<li><a href="https://tomcat.apache.org/download-70.cgi">Apache</a></li>
<li><a href="https://archive.apache.org/dist/tomcat/">Tomcat</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># 버전에 맞춰서 다운로드</span>
&gt; <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">CATALINA_HOME</span><span style="color:#f1fa8c">}</span>/bin/catalina.sh version

&gt; curl -LO https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.41/bin/extras/catalina-jmx-remote.jar

&gt; <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">CATALINA_HOME</span><span style="color:#f1fa8c">}</span>/bin/catalina.sh start <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-Dcom.sun.management.jmxremote <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-Dcom.sun.management.jmxremote.local.only<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">false</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-Dcom.sun.management.jmxremote.port<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1099</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-Dcom.sun.management.jmxremote.rmi.port<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1099</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-Dcom.sun.management.jmxremote.ssl<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">false</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-Dcom.sun.management.jmxremote.authenticate<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">false</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-Djava.rmi.server.hostname<span style="color:#ff79c6">=</span>127.0.0.1 <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-jar
</code></pre></div><h1 id="gc-monitoring">GC Monitoring</h1>
<p>GC 모니터링이란 JVM이 어떻게 GC를 수행하고 있는지 알아내는 과정을 말한다.</p>
<h2 id="tool-2">Tool</h2>
<p>처음이라면 NAVER D2에 올라온 글
&lsquo;<a href="https://d2.naver.com/helloworld/6043">Garbage Collection 모니터링 방법</a>&lsquo;이 굉장히 도움된다.</p>
<h3 id="jstat">jstat</h3>
<ul>
<li>JVM Statistics Monitoring</li>
<li><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html">공식 문서</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># 1초마다 gc 확인</span>
&gt; jstat -gc &lt;PID&gt; <span style="color:#bd93f9">1000</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">&gt; jstat -options
</code></pre></div><table>
<thead>
<tr>
<th>옵션</th>
<th>기능</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>gc</strong></td>
<td>각 힙(heap) 영역의 현재 크기와 현재 사용량(Eden 영역, Survivor 영역, Old 영역등), 총 GC 수행 횟수, 누적 GC 소요 시간을 보여 준다.</td>
</tr>
<tr>
<td><strong>gccapactiy</strong></td>
<td>각 힙 영역의 최소 크기(ms), 최대 크기(mx), 현재 크기, 각 영역별 GC 수행 횟수를 알 수 있는 정보를 보여 준다. 단, 현재 사용량과 누적 GC 소요 시간은 알 수 없다.</td>
</tr>
<tr>
<td><strong>gccause</strong></td>
<td>-gcutil 옵션이 제공하는 정보와 함께 마지막 GC 원인과 현재 발생하고 있는 GC의 원인을 알 수 있는 정보를 보여 준다.</td>
</tr>
<tr>
<td>gcnew</td>
<td>New 영역에 대한 GC 수행 정보를 보여 준다.</td>
</tr>
<tr>
<td>gcnewcapacity</td>
<td>New 영역의 크기에 대한 통계 정보를 보여 준다.</td>
</tr>
<tr>
<td>gcold</td>
<td>Old 영역에 대한 GC 수행 정보를 보여 준다.</td>
</tr>
<tr>
<td>gcoldcapacity</td>
<td>Old 영역의 크기에 대한 통계 정보를 보여 준다.</td>
</tr>
<tr>
<td>gcpermcapacity</td>
<td>Permanent 영역에 대한 통계 정보를 보여 준다.</td>
</tr>
<tr>
<td><strong>gcutil</strong></td>
<td>각 힙 영역에 대한 사용 정도를 백분율로 보여 준다. 아울러 총 GC 수행 횟수와 누적 GC 시간을 알 수 있다.</td>
</tr>
</tbody>
</table>
<h3 id="visual-gc">Visual GC</h3>
<p>JVM이 어떻게 GC를 수행하고 있는지 확인할 수 있다.</p>
<p><img src="/images/java/jvm-monitoring/visualgc-plugin.png" alt="VisualGC Plugin"></p>
<p><em>VisualVM의 Tools &gt; Plugins에서 다운로드 할 수 있다.</em></p>
<p><img src="/images/java/jvm-monitoring/visualgc-with-visualvm.png" alt="visualgc-with-visualvm"></p>
<h1 id="함께-사용하는-도구들">함께 사용하는 도구들</h1>
<h2 id="jdk-tools">JDK Tools</h2>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/index.html">JDK Tools and Utilities</a></li>
</ul>
<p><img src="/images/java/java-conceptual-diagram.png" alt="Java Platform Standard Edition 8 Documentation"></p>
<p><em><a href="https://docs.oracle.com/javase/8/docs/">Java Platform Standard Edition 8 Documentation</a></em></p>
<ul>
<li>jcmd: 성능 관련 카운터 조회</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">&gt; jcmd <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">PID</span><span style="color:#f1fa8c">}</span> PerfCounter.print
java.threads.daemon<span style="color:#ff79c6">=</span><span style="color:#bd93f9">42</span>
java.threads.live<span style="color:#ff79c6">=</span><span style="color:#bd93f9">49</span>
java.threads.livePeak<span style="color:#ff79c6">=</span><span style="color:#bd93f9">52</span>
java.threads.started<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3951</span>
...
</code></pre></div><ul>
<li>jmap: JVM Heap 조회</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">&gt; jmap -heap <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">PID</span><span style="color:#f1fa8c">}</span>
Attaching to process ID 3838860, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 25.292-b10

using thread-local object allocation.
Parallel GC with <span style="color:#bd93f9">10</span> thread<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>

Heap Configuration:
   <span style="color:#8be9fd;font-style:italic">MinHeapFreeRatio</span>         <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
   <span style="color:#8be9fd;font-style:italic">MaxHeapFreeRatio</span>         <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">100</span>
   <span style="color:#8be9fd;font-style:italic">MaxHeapSize</span>              <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8348762112</span> <span style="color:#ff79c6">(</span>7962.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">NewSize</span>                  <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">174063616</span> <span style="color:#ff79c6">(</span>166.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">MaxNewSize</span>               <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2782920704</span> <span style="color:#ff79c6">(</span>2654.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">OldSize</span>                  <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">348127232</span> <span style="color:#ff79c6">(</span>332.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">NewRatio</span>                 <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2</span>
   <span style="color:#8be9fd;font-style:italic">SurvivorRatio</span>            <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8</span>
   <span style="color:#8be9fd;font-style:italic">MetaspaceSize</span>            <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">21807104</span> <span style="color:#ff79c6">(</span>20.796875MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">CompressedClassSpaceSize</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1073741824</span> <span style="color:#ff79c6">(</span>1024.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">MaxMetaspaceSize</span>         <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">17592186044415</span> MB
   <span style="color:#8be9fd;font-style:italic">G1HeapRegionSize</span>         <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">(</span>0.0MB<span style="color:#ff79c6">)</span>

Heap Usage:
PS Young Generation
Eden Space:
   <span style="color:#8be9fd;font-style:italic">capacity</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2094006272</span> <span style="color:#ff79c6">(</span>1997.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">used</span>     <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">398200696</span> <span style="color:#ff79c6">(</span>379.75377655029297MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">free</span>     <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1695805576</span> <span style="color:#ff79c6">(</span>1617.246223449707MB<span style="color:#ff79c6">)</span>
   19.0162131472355% used
From Space:
   <span style="color:#8be9fd;font-style:italic">capacity</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">82837504</span> <span style="color:#ff79c6">(</span>79.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">used</span>     <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">(</span>0.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">free</span>     <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">82837504</span> <span style="color:#ff79c6">(</span>79.0MB<span style="color:#ff79c6">)</span>
   0.0% used
To Space:
   <span style="color:#8be9fd;font-style:italic">capacity</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">78643200</span> <span style="color:#ff79c6">(</span>75.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">used</span>     <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">(</span>0.0MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">free</span>     <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">78643200</span> <span style="color:#ff79c6">(</span>75.0MB<span style="color:#ff79c6">)</span>
   0.0% used
PS Old Generation
   <span style="color:#8be9fd;font-style:italic">capacity</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">467140608</span> <span style="color:#ff79c6">(</span>445.5MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">used</span>     <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">107232904</span> <span style="color:#ff79c6">(</span>102.26526641845703MB<span style="color:#ff79c6">)</span>
   <span style="color:#8be9fd;font-style:italic">free</span>     <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">359907704</span> <span style="color:#ff79c6">(</span>343.23473358154297MB<span style="color:#ff79c6">)</span>
   22.955166423896078% used

<span style="color:#bd93f9">47952</span> interned Strings occupying <span style="color:#bd93f9">5230216</span> bytes.
</code></pre></div><ul>
<li>jhat: Java Heap Analyzer Tool
<ul>
<li>JDK 9에서 제거되었다.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">&gt; jhat -J-Xmx6g -port <span style="color:#bd93f9">7000</span> /path/app.hprof
</code></pre></div><h2 id="datadog">Datadog</h2>
<ul>
<li><a href="https://docs.datadoghq.com/tracing/profiler/enabling/java/">Enabling the Java Profiler</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">-Ddd.profiling.enabled<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">true</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-XX:FlightRecorderOptions<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">stackdepth</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">256</span>
</code></pre></div><h2 id="이-외의-도구들">이 외의 도구들</h2>
<ul>
<li><a href="https://www.oracle.com/java/technologies/jdk-mission-control.html">JDK Mission Control</a> - Oracle</li>
<li><a href="https://github.com/pinpoint-apm/pinpoint">Pinpoint</a> - NAVER에서 만든 오픈소스 APM</li>
<li><a href="https://www.yourkit.com/java/profiler">Java Profiler Features</a> - YourKit</li>
<li><a href="https://www.ej-technologies.com/products/jprofiler/overview.html">JProfiler</a> (유료)</li>
</ul>
<h1 id="더-읽을-거리">더 읽을 거리</h1>
<p>다른 개발자들의 실제 사례를 보면 얻을 수 있는 인사이트가 많다.</p>
<h2 id="thread-stack">Thread Stack</h2>
<ul>
<li><a href="https://d2.naver.com/helloworld/10963">스레드 덤프 분석하기</a> - NAVER D2</li>
<li><a href="https://dzone.com/articles/how-to-read-a-thread-dump">How to Read a Thread Dump</a> - DZone</li>
<li><a href="https://johngrib.github.io/wiki/jvm-stack/">JVM stack과 frame</a> - 기계인간 John Grib</li>
</ul>
<h2 id="heap-memory">Heap Memory</h2>
<ul>
<li><a href="https://d2.naver.com/helloworld/1326256">하나의 메모리 누수를 잡기까지</a> - NAVER D2</li>
<li><a href="https://techblog.woowahan.com/2628/">도움이 될수도 있는 JVM memory leak 이야기</a> - 우아한 형제들</li>
<li><a href="https://d2.naver.com/helloworld/184615">자바 애플리케이션 성능 튜닝의 도(道)</a> - NAVER D2</li>
<li><a href="https://d2.naver.com/helloworld/1286587">Java 애플리케이션 트러블 슈팅</a> - NAVER D2</li>
<li><a href="https://kwonnam.pe.kr/wiki/java/memory">Java Memory Analysis</a> - 권남</li>
<li><a href="https://www.whatap.io/ko/blog/28/">JVM Crash 문제 해결하기</a> - 와탭</li>
<li><a href="https://cselabnotes.com/kr/2021/03/26/39/">JMap, JHat으로 Heap Dump 분석</a> - 삐멜</li>
<li><a href="http://honeymon.io/tech/2019/05/30/java-memory-leak-analysis.html">자바 메모리누수(with 힙덤프) 분석하기</a> - 김지헌</li>
<li><a href="https://lng1982.tistory.com/352">Java Heap Dump 를 이용한 문제 해결</a> - 탁구치는 개발자</li>
<li><a href="https://sarc.io/index.php/java/1092-jvm-default-heap-size">JVM의 default Heap Size가 궁금하세요?</a> - 삵(sarc)</li>
<li><a href="https://perfectacle.github.io/2019/04/28/heap-memory-analytics-with-eclipse-mat/">생애 첫 Heap 메모리 분석기</a> - 양권성</li>
<li><a href="https://spoqa.github.io/2012/02/06/eclipse-mat.html">Eclipse Memory Analyzer 소개</a> - spoqa</li>
<li><a href="https://dzone.com/articles/eclipse-mat-incoming-outgoing-references">Eclipse MAT — Incoming, Outgoing References</a> - DZone</li>
<li><a href="https://www.baeldung.com/visualvm-jmx-remote">Remote Monitoring with VisualVM and JMX</a></li>
<li><a href="https://www.lesstif.com/java/apache-tomcat-jmx-monitoring-20776824.html">아파치 톰캣(Apache Tomcat)을 JMX로 Remote Monitoring 하기</a></li>
<li>전문가를 위한 스프링 5 (15장 애플리케이션 모니터링)</li>
</ul>
<h2 id="garbage-collection">Garbage Collection</h2>
<ul>
<li>&lt;<a href="https://www.aladin.co.kr/shop/wproduct.aspx?ISBN=9788979145229">자바 성능을 결정짓는 코딩 습관과 튜닝 이야기</a>&gt;라는
책의 저자가 쓰신 글들은 모두 재밌고 유용하다.
<ul>
<li><a href="https://d2.naver.com/helloworld/6043">Garbage Collection 모니터링 방법</a> - NAVER D2</li>
<li><a href="https://d2.naver.com/helloworld/4717">Garbage Collection과 Statement Pool</a> - NAVER D2
<ul>
<li><a href="https://zzikjh.tistory.com/entry/DBCP-%EC%82%AC%EC%9A%A9%EC%8B%9C-poolPreparedStatements-%EC%86%8D%EC%84%B1%EC%9D%B4-%EC%84%B1%EB%8A%A5%EC%97%90-%EB%AF%B8%EC%B9%98%EB%8A%94-%EC%98%81%ED%96%A5">DBCP 사용시 poolPreparedStatements 속성이 성능에 미치는 영향</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="기타">기타</h2>
<ul>
<li><a href="https://blog.naver.com/pcmola/222064546600">Java 프로파일링 도구</a> - 메이커 꾸러기</li>
<li><a href="https://www.infoq.com/news/2015/12/OpenJDK-9-removal-of-HPROF-jhat/">OpenJDK 9: Life Without HPROF and jhat</a> - InfoQ</li>
<li><a href="https://youtu.be/8wHx31mvSLY">Everything I Ever Learned About JVM Performance Tuning at Twitter</a> - Attila Szegedi</li>
</ul>

            
            
            
            
          </div>
        </div>


        <nav class="post-pagination">
          
          <a class="newer-posts" href="https://markruler.github.io/posts/ci/jvm-monitoring/">
            다음 글<br>Load Balancer를 활용해서 배포 프로세스를 개선해보자
          </a>
          

          
          <a class="older-posts" href="https://markruler.github.io/posts/java/java-timeout-monitoring/">
            이전 글<br>모니터링과 타임아웃의 중요성
          </a>
          
        </nav>
        
        <div class="post-comment-wrapper">
          
          







        </div>

        
        





<section class="social-share">
  <ul class="share-icons">
    
    
    <li>
      <a href="https://twitter.com/intent/tweet?hashtags=markruler,dev&amp;url=https%3a%2f%2fmarkruler.github.io%2fposts%2fjava%2fjvm-monitoring%2f&amp;text=JVM%20%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81" target="_blank" rel="noopener" aria-label="Share on Twitter" class="share-btn twitter">
        
<svg xmlns:xlink="http://www.w3.org/1999/xlink" id="twitter" viewBox="0 0 48 48" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">bg</title>
    <circle cx="24" cy="24" fill="#1CB7EB" r="24" style="pointer-events:inherit" id="svg_1"></circle>
    <path d="M36.8,15.4C35.9,15.9 34.8,16.2 33.8,16.3C34.9,15.6 35.7,14.5 36.1,13.2C35.1,13.8 34,14.3 32.7,14.6C31.7,13.5 30.4,12.8 28.9,12.8C26,12.8 23.6,15.3 23.6,18.5C23.6,18.9 23.6,19.4 23.7,19.8C19.3,19.6 15.4,17.3 12.8,13.9C12.3,14.7 12.1,15.7 12.1,16.8C12.1,18.8 13,20.5 14.4,21.5C13.5,21.5 12.7,21.2 12,20.8C12,20.8 12,20.9 12,20.9C12,23.6 13.8,25.9 16.2,26.5C15.8,26.6 15.3,26.7 14.8,26.7C14.5,26.7 14.1,26.7 13.8,26.6C14.5,28.9 16.4,30.5 18.7,30.5C16.9,32 14.6,32.9 12.2,32.9C11.8,32.9 11.4,32.9 10.9,32.8C13.2,34.4 16,35.4 19,35.4C28.7,35.4 34,26.8 34,19.3C34,19.1 34,18.8 34,18.6C35.2,17.6 36.1,16.6 36.8,15.4z" fill="#FFFFFF" style="pointer-events:inherit" id="svg_4"></path>
  </g>
</svg>
        <p>Twitter</p>
      </a>
    </li>
    

    
    
    <li>
      <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmarkruler.github.io%2fposts%2fjava%2fjvm-monitoring%2f" target="_blank" rel="noopener" aria-label="Share on Facebook" class="share-btn facebook">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 48 48" id="facebook" version="1.1" viewBox="0 0 48 48" xml:space="preserve">
  <circle cx="24" cy="24" fill="#4E71A8" r="24" />
  <path d="M29.9,19.5h-4v-2.6c0-1,0.7-1.2,1.1-1.2c0.5,0,2.8,0,2.8,0v-4.4l-3.9,0c-4.4,0-5.3,3.3-5.3,5.3v2.9h-2.5V24  h2.5c0,5.8,0,12.7,0,12.7h5.3c0,0,0-7,0-12.7h3.6L29.9,19.5z" fill="#FFFFFF" />
</svg>
        <p>Facebook</p>
        </a>
    </li>
    

    
    
    <li>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmarkruler.github.io%2fposts%2fjava%2fjvm-monitoring%2f&amp;source=https%3a%2f%2fmarkruler.github.io%2fposts%2fjava%2fjvm-monitoring%2f&amp;title=JVM%20%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81&amp;summary=JVM%20%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81" target="_blank" rel="noopener" aria-label="Share on LinkedIn" class="share-btn linkedin">
        <svg xmlns:xlink="http://www.w3.org/1999/xlink" id="linkedin" viewBox="0 0 128 128" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:none">
    <title style="pointer-events:inherit">background</title>
    <rect x="-1" y="-1" width="582" height="402" id="canvas_background" fill="none" style="pointer-events:inherit"></rect>
  </g>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">Layer 1</title>
    <circle cx="64" cy="64" fill="#0076B4" r="64" id="svg_2" stroke-dasharray="none"></circle>
    <path d="M44.119,95.934L29.184,95.934L29.184,47.93L44.119,47.93L44.119,95.934zM36.656,41.371C31.864,41.371 28,37.495 28,32.718C28,27.943 31.864,24.066 36.656,24.066C41.427,24.066 45.302,27.942 45.302,32.718C45.303,37.495 41.428,41.371 36.656,41.371zM100,95.934L85.081,95.934L85.081,72.59C85.081,67.024 84.984,59.862 77.329,59.862C69.564,59.862 68.381,65.927 68.381,72.192L68.381,95.934L53.479,95.934L53.479,47.93L67.78,47.93L67.78,54.492L67.984,54.492C69.974,50.718 74.841,46.739 82.101,46.739C97.206,46.739 99.998,56.678 99.998,69.607L100,95.934L100,95.934z" fill="#FFFFFF" style="pointer-events:inherit" id="svg_4"></path>
  </g>
</svg>
          <p>LinkedIn</p>
        </a>
    </li>
    

    
    

    
    
    <li>
      <a href="mailto:?subject= - JVM%20%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81.&amp;body=JVM%20%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%2c%20by%20%0a%ec%9d%b4%ea%b2%8c%20%ec%99%9c%20%ec%a3%bd%ec%a7%80..%3f%0a%0ahttps%3a%2f%2fmarkruler.github.io%2fposts%2fjava%2fjvm-monitoring%2f%0a" target="_blank" class="share-btn email">
        <svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" id="email" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:none">
    <title style="pointer-events:inherit">background</title>
    <rect x="-1" y="-1" width="582" height="402" id="canvas_background" fill="none" style="pointer-events:inherit"></rect>
  </g>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">Layer 1</title>
    <path d="M16,0C7.163,0 0,7.163 0,16C0,24.836 7.163,32 16,32S32,24.836 32,16C32,7.163 24.837,0 16,0z" fill="#333333" style="pointer-events:inherit" id="svg_2"></path>
    <polygon fill="#FFFFFF" points="6.518,21.815 11.707,15.291 6.518,12.119   " style="pointer-events:inherit" id="svg_4"></polygon>
    <polygon fill="#FFFFFF" points="19.5,15.746 15.989,17.908 12.472,15.758 7.11,22.5 24.867,22.5   " style="pointer-events:inherit" id="svg_5"></polygon>
    <polygon fill="#FFFFFF" points="15.988,16.864 25.482,11.017 25.482,9.5 6.518,9.5 6.518,11.076   " style="pointer-events:inherit" id="svg_6"></polygon>
    <polygon fill="#FFFFFF" points="20.263,15.276 25.482,21.843 25.482,12.062   " style="pointer-events:inherit" id="svg_7"></polygon>
  </g>
</svg>
        <p>Email</p>
      </a>
    </li>
  </ul>
</section>


      </div>
    </div>
  </div>
  
    </div><div id="single-column-footer">


&copy;
	
	Im Changsu 2020 - 2022
	
</div>
  </div>
  <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            }
    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
                this.toggleDarkMode();
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});
</script>

<script src="https://markruler.github.io//js/journal.js"></script>
</body>

</html>