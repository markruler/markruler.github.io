<!DOCTYPE html>
<html><head>
<title>모니터링과 타임아웃의 중요성</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="G-FFMDWZ27TN">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="이거 모르는 개발자 많다카더라">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="모니터링과 타임아웃의 중요성" />
<meta property="og:description" content="이거 모르는 개발자 많다카더라" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://markruler.github.io/posts/java/java-timeout-monitoring/" /><meta property="og:image" content="https://markruler.github.io/images/datadog/alert-threshold.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-11T02:19:00+09:00" />
<meta property="article:modified_time" content="2022-05-11T02:19:00+09:00" />






<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://markruler.github.io/images/datadog/alert-threshold.png"/>

<meta name="twitter:title" content="모니터링과 타임아웃의 중요성"/>
<meta name="twitter:description" content="이거 모르는 개발자 많다카더라"/>







<script async src="https://www.googletagmanager.com/gtag/js?id=G-FFMDWZ27TN"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-FFMDWZ27TN', { 'anonymize_ip': false });
}
</script>







  




<link rel="icon" href="https://markruler.github.io/images/favicon.ico">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.02a482ebb330e36958a54ca8d1e6175b37fb0742710c08f013d129155839e07c.css" integrity="sha256-AqSC67Mw42lYpUyo0eYXWzf7B0JxDAjwE9EpFVg54Hw=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Posts
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 목차 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%83%81%ed%99%a9" class="nav-상황">
									상황
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%eb%b6%84%ec%84%9d" class="nav-분석">
									분석
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ed%95%b4%ea%b2%b0" class="nav-해결">
									해결
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#sql-%ed%8a%9c%eb%8b%9d" class="nav-sql-튜닝">
									SQL 튜닝
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#timeout-%ec%84%a4%ec%a0%95" class="nav-timeout-설정">
									Timeout 설정
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ec%b6%94%ea%b0%80%ec%a0%81%ec%9d%b8-%eb%ac%b8%ec%a0%9c" class="nav-추가적인-문제">
									추가적인 문제
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#monitoring" class="nav-monitoring">
									Monitoring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#log-tracing--error-tracking" class="nav-log-tracing--error-tracking">
									Log Tracing &amp; Error Tracking
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#spring-aop" class="nav-spring-aop">
									Spring AOP
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ec%83%81%ed%99%a9-2" class="nav-상황-2">
									상황 2
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%eb%b6%84%ec%84%9d-2" class="nav-분석-2">
									분석 2
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ed%95%b4%ea%b2%b0-2" class="nav-해결-2">
									해결 2
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ea%b2%b0%eb%a1%a0" class="nav-결론">
									결론
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%8d%94-%ec%9d%bd%ec%9d%84-%ea%b1%b0%eb%a6%ac" class="nav-더-읽을-거리">
									더 읽을 거리
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#logging" class="nav-logging">
									Logging
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#monitoring-1" class="nav-monitoring-1">
									Monitoring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#transaction" class="nav-transaction">
									Transaction
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://markruler.github.io/">
            임창수 블로그
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://markruler.github.io/">
        <div class="single-column-header-title">임창수 블로그</div>
        
        <div class="single-column-header-subtitle">What, Why, How.</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://markruler.github.io/images/datadog/alert-threshold.png')"
                    
                
            >
                <div class="post-title">
                    모니터링과 타임아웃의 중요성
                    
                    <div class="post-subtitle">
                        이거 모르는 개발자 많다카더라
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-05-11 02:19
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[how-to]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">java</a>
                                &nbsp;
                            
                                <a href="/tags/spring">spring</a>
                                &nbsp;
                            
                                <a href="/tags/monitoring">monitoring</a>
                                &nbsp;
                            
                                <a href="/tags/timeout">timeout</a>
                                &nbsp;
                            
                                <a href="/tags/datadog">datadog</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <blockquote>
<p><a href="/posts/cloud/monitor-trace-log-metric/">Observability 용어 정리</a></p>
</blockquote>
<h1 id="상황">상황</h1>
<ul>
<li>현재팀에서 만들고 있는 애플리케이션은 Spring Framework로 작성하고 있다.</li>
<li>계속 특정 애플리케이션과 함께 여러 애플리케이션에서 후속 장애가 발생했다.</li>
<li>장애가 발생할 때마다 특정 API의 커넥션이 끊기지 않고 오랜 시간 유지되고 있었다.</li>
</ul>
<p><img src="/images/datadog/transaction-deadlock.png" alt="transaction-deadlock"></p>
<p><em><code>RedisSystemException</code>은 해당 서버를 죽이면서 Redis와 커넥션이 끊어졌기 때문에 발생한 예외다.
만약 서버를 죽이지 않았다면 끝까지 물고 있었을 것이다.</em></p>
<h2 id="분석">분석</h2>
<p>시간만 보고도 Timeout이 설정되어 있지 않다는 것을 확인할 수 있다.
설정하지 않으면 <strong>default 값은 -1</strong> 로 타임아웃이 발생하지 않는다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#6272a4">// org.springframework.transaction.support.AbstractPlatformTransactionManager
</span><span style="color:#6272a4"></span>TransactionDefinition<span style="color:#ff79c6">.</span><span style="color:#50fa7b">TIMEOUT_DEFAULT</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">;</span>
</code></pre></div><p>하지만 트랜잭션이 왜 저렇게 오래 유지되는지 알 수 없었다.
그래도 서버 장애가 발생하는 이유는 알 수 있었다.
TImeout이 발생하지 않다보니 해당 트랜잭션들 사이에 데드락(Deadlock)이 발생했고
하나의 서비스 뿐만 아니라 해당 테이블을 사용하는 모든 서비스에 장애가 발생했다.</p>
<h2 id="해결">해결</h2>
<h3 id="sql-튜닝">SQL 튜닝</h3>
<p>가장 먼저 시도한 건 SQL 튜닝이었다.
해당 트랜잭션이 왜 끊기지 않았는지 파악할 수 없었지만 해당 SQL을 실행시켰을 때 무려 8초 가량이 소요되었다.
튜닝을 통해 개선한 SQL은 약 1.1초 가량 소요되었다. (이후 1초 이내로 튜닝해보자..!)</p>
<h3 id="timeout-설정">Timeout 설정</h3>
<p>Transaction Timeout은 <code>TransactionManager</code> 에 설정해야 한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#ff79c6">&lt;</span>bean id<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;transactionManager&#34;</span> class<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span style="color:#ff79c6">&gt;</span>
    <span style="color:#ff79c6">&lt;</span>constructor<span style="color:#ff79c6">-</span>arg ref<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;dataSource&#34;</span><span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;</span>property name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;defaultTimeout&#34;</span> value<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;30&#34;</span><span style="color:#ff79c6">/&gt;</span>
<span style="color:#ff79c6">&lt;/</span>bean<span style="color:#ff79c6">&gt;</span>
</code></pre></div><p>만약 특정 메서드에만 다른 타임아웃 값을 설정하고 싶다면 메서드 레벨에 <code>@Transactional</code> 을 설정한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#6272a4">// timeout은 seconds 단위
</span><span style="color:#6272a4"></span>@Transactional<span style="color:#ff79c6">(</span>readOnly <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">,</span> timeout <span style="color:#ff79c6">=</span> 10<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">list</span><span style="color:#ff79c6">(</span>Param param<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
  <span style="color:#ff79c6">return</span> repository<span style="color:#ff79c6">.</span><span style="color:#50fa7b">list</span><span style="color:#ff79c6">(</span>param<span style="color:#ff79c6">);</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><h1 id="추가적인-문제">추가적인 문제</h1>
<p>우리 팀은 모니터링 도구로 Datadog을 사용하고 있다.
그런데 알람 임계점(Alert threshold)이 낮게 설정되어 있어서 불필요한 알람이 아주 많이 발생했다.
개발팀은 이 알람들을 무시하고 있었고, 실제로 장애가 발생했을 때 백이면 백 개발팀보다 다른 팀에서 먼저 감지했다.</p>
<h2 id="monitoring">Monitoring</h2>
<p>그래서 임계점을 높게 설정했다.
이미 Datadog 도입 시점부터 알람이 자주 발생했는데도 고치지 않았던 것으로 보인다.</p>
<p><img src="/images/datadog/alert-threshold.png" alt="alert-threshold"></p>
<p><em>10 minutes Average Latency</em></p>
<p>위 Average Latency 그래프에서 스파이크(spike) 부분이 서버 장애가 발생했던 시점이다.
그런데 이전부터 거의 구분할 수 없을 정도로 Alert가 발생하던 것을 확인할 수 있다.
임계점을 높인 이후에는 정상적인 애플리케이션에서는 <code>OK</code>가 표시된다.</p>
<p>임계점에 대한 기준은 과거 이력을 보고 설정했다.
장애가 발생하던 시점에 전조가 보이기 시작한 값을 경고 임계점(Warning threshold)으로 설정하고,
증상이 나타났을 때 값을 알람 임계점으로 설정했다.
— 정확한 기준이라고는 할 수 없다. 앞으로도 알람이 발생할 때마다 조정할 예정이다.</p>
<h2 id="log-tracing--error-tracking">Log Tracing &amp; Error Tracking</h2>
<p>Datadog의 APM(Application Performance Management) 서비스는
애플리케이션의 성능을 실시간으로 분석할 수 있게 도와주고
에러가 발생했을 때 트레이싱 할 수 있도록 도와준다.
하지만 제대로 트레이싱하기 위해서는 이해할 수 있는 로그가 남아야 한다.</p>
<p>우리 팀에서 작성한 애플리케이션은 Logback을 Logging Framework로 사용하고 있었는데
이를 사용하지 않고 표준 출력(<code>System.out</code>)을 사용하는 부분이 군데군데 보였다.
게다가 공통 로깅을 AOP로 분리하지 않고 각각의 메서드에서 처리하고 있었다.</p>
<p><code>System.out</code> 을 사용하면 로그 레벨이나 목적별로 분리해서 설정할 수 없을 뿐더러
애플리케이션 로그 파일에 로그가 남지 않고 Tomcat의 <code>catalina.out</code> 에 남는다.
그럼 특정 기능에서 에러가 발생하는데도 로그를 확인하기 어렵다.
Checkstyle을 도입해서 모든 <code>System.out</code>, <code>System.err</code>(<code>printStackTrace</code> 포함)을 Logger로 대체했다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-xml" data-lang="xml"><span style="color:#6272a4">&lt;!-- checkstyle.xml --&gt;</span>
<span style="color:#ff79c6">&lt;module</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;RegexpSinglelineJava&#34;</span><span style="color:#ff79c6">&gt;</span>
    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;id&#34;</span> <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;SystemOutput&#34;</span><span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;format&#34;</span> <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;^.*System\.(out|err).*$&#34;</span><span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;ignoreComments&#34;</span> <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;true&#34;</span><span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;message&#34;</span>
              <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;Don&#39;t use System.out/err, use Logger instead.&#34;</span><span style="color:#ff79c6">/&gt;</span>
<span style="color:#ff79c6">&lt;/module&gt;</span>
<span style="color:#ff79c6">&lt;module</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;RegexpSinglelineJava&#34;</span><span style="color:#ff79c6">&gt;</span>
    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;id&#34;</span> <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;printStackTrace&#34;</span><span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;format&#34;</span> <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;printStackTrace&#34;</span><span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;ignoreComments&#34;</span> <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;true&#34;</span><span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;message&#34;</span>
              <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;Don&#39;t use printStackTrace, use Logger instead.&#34;</span><span style="color:#ff79c6">/&gt;</span>
<span style="color:#ff79c6">&lt;/module&gt;</span>
</code></pre></div><p>특히 선임 중 한 분이 <a href="https://twitter.com/rpbaltazar/status/1458979690790539266">“200 OK, But”</a> 방식을 선호했다.
이 방식은 오류가 발생해도 잡아서(catch) <code>200 OK</code> 응답을 보낸다.
<strong>에러가 발생하는데도 모니터링 도구에서는 마치 애플리케이션이 정상적인 것처럼 보인다.</strong>
이런 방식은 HTTP가 네트워크 프로토콜이라는 것을 고려해보면
서버와 클라이언트 간 커뮤니케이션을 더 힘들게 만든다는 것을 알 수 있다.
그래서 그 분이 퇴사하시자마자 HTTP 상태 코드를 분리했다.</p>
<p><img src="/images/web/200-ok-but.webp" alt="200-ok-but"></p>
<p><em>&ldquo;200 OK, but&rdquo;</em></p>
<h2 id="spring-aop">Spring AOP</h2>
<p>마지막으로 AOP를 이용해서 공통 로깅을 분리했다.
예를 들어 트랜잭션 타임아웃이 발생하면 <code>TransactionTimedOutException</code> 예외가 발생한다.
그래서 해당 예외를 위한 핸들러를 추가했다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#6272a4">// org.springframework.transaction.TransactionTimedOutException
</span><span style="color:#6272a4"></span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">springframework</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">transaction</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">TransactionTimedOutException</span><span style="color:#ff79c6">:</span> Transaction timed out<span style="color:#ff79c6">:</span> deadline was Wed May 04 16<span style="color:#ff79c6">:</span>42<span style="color:#ff79c6">:</span>38 KST 2022
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">springframework</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">transaction</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">support</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ResourceHolderSupport</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">checkTransactionTimeout</span><span style="color:#ff79c6">(</span>ResourceHolderSupport<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>141<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">springframework</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">transaction</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">support</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ResourceHolderSupport</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">getTimeToLiveInMillis</span><span style="color:#ff79c6">(</span>ResourceHolderSupport<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>130<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">springframework</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">transaction</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">support</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ResourceHolderSupport</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">getTimeToLiveInSeconds</span><span style="color:#ff79c6">(</span>ResourceHolderSupport<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>114<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">mybatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spring</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">transaction</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SpringManagedTransaction</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">getTimeout</span><span style="color:#ff79c6">(</span>SpringManagedTransaction<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>139<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">executor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SimpleExecutor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">prepareStatement</span><span style="color:#ff79c6">(</span>SimpleExecutor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>87<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">executor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SimpleExecutor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">doQuery</span><span style="color:#ff79c6">(</span>SimpleExecutor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>62<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">executor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">BaseExecutor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">queryFromDatabase</span><span style="color:#ff79c6">(</span>BaseExecutor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>325<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">executor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">BaseExecutor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">query</span><span style="color:#ff79c6">(</span>BaseExecutor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>156<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">executor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">CachingExecutor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">query</span><span style="color:#ff79c6">(</span>CachingExecutor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>109<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">executor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">CachingExecutor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">query</span><span style="color:#ff79c6">(</span>CachingExecutor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>89<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">session</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">defaults</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">DefaultSqlSession</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectList</span><span style="color:#ff79c6">(</span>DefaultSqlSession<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>151<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">session</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">defaults</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">DefaultSqlSession</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectList</span><span style="color:#ff79c6">(</span>DefaultSqlSession<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>145<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">session</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">defaults</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">DefaultSqlSession</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectList</span><span style="color:#ff79c6">(</span>DefaultSqlSession<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>140<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">session</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">defaults</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">DefaultSqlSession</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectOne</span><span style="color:#ff79c6">(</span>DefaultSqlSession<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>76<span style="color:#ff79c6">)</span>
        at sun<span style="color:#ff79c6">.</span><span style="color:#50fa7b">reflect</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">GeneratedMethodAccessor113</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>Unknown Source<span style="color:#ff79c6">)</span>
        at sun<span style="color:#ff79c6">.</span><span style="color:#50fa7b">reflect</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">DelegatingMethodAccessorImpl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>DelegatingMethodAccessorImpl<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>43<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">reflect</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Method</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>Method<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>498<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">mybatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spring</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SqlSessionTemplate$SqlSessionInterceptor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>SqlSessionTemplate<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>434<span style="color:#ff79c6">)</span>
        at com<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sun</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">proxy</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">$Proxy36</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectOne</span><span style="color:#ff79c6">(</span>Unknown Source<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">mybatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spring</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SqlSessionTemplate</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectOne</span><span style="color:#ff79c6">(</span>SqlSessionTemplate<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>167<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">binding</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MapperMethod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span>MapperMethod<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>87<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">binding</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MapperProxy$PlainMethodInvoker</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>MapperProxy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>145<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ibatis</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">binding</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MapperProxy</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>MapperProxy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>86<span style="color:#ff79c6">)</span>
        <span style="color:#ff79c6">...</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java">@ControllerAdvice
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ServerErrorAdvice</span> <span style="color:#ff79c6">{</span>
    @ResponseBody
    @ResponseStatus<span style="color:#ff79c6">(</span>HttpStatus<span style="color:#ff79c6">.</span><span style="color:#50fa7b">INTERNAL_SERVER_ERROR</span><span style="color:#ff79c6">)</span>
    @ExceptionHandler<span style="color:#ff79c6">(</span>TransactionTimedOutException<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
    <span style="color:#8be9fd;font-style:italic">public</span> ErrorResponse <span style="color:#50fa7b">handleTransactionTimedOutException</span><span style="color:#ff79c6">(</span>TransactionTimedOutException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> ErrorResponse<span style="color:#ff79c6">(</span>e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">toString</span><span style="color:#ff79c6">());</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><p>이때까지만 해도 해결된 것으로 보였다.</p>
<h1 id="상황-2">상황 2</h1>
<p><img src="/images/datadog/transaction-timeout.png" alt="transaction-timeout"></p>
<p>주말이 지나고 월요일 아침, 갑자기 레이턴시가 높아지고 <code>TransactionTimedOutException</code> 예외가 발생했다.</p>
<h2 id="분석-2">분석 2</h2>
<p>예외가 발생한 코드는 다음과 같은 구조를 가졌다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java">@Service
@Transactional
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ServiceImpl</span> <span style="color:#8be9fd;font-style:italic">implements</span> Service <span style="color:#ff79c6">{</span>

    @Override
    <span style="color:#8be9fd;font-style:italic">public</span> List<span style="color:#ff79c6">&lt;</span>Result<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">list</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
        Response response <span style="color:#ff79c6">=</span> callHttpClientWithoutTimeout<span style="color:#ff79c6">();</span> <span style="color:#6272a4">// (2) TransactionTimedOutException 발생
</span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">return</span> accessDb<span style="color:#ff79c6">(</span>response<span style="color:#ff79c6">);</span>
    <span style="color:#ff79c6">}</span>

    @Override
    <span style="color:#8be9fd;font-style:italic">public</span> Response <span style="color:#50fa7b">callHttpClientWithoutTimeout</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
        CloseableHttpClient httpClient <span style="color:#ff79c6">=</span> HttpClients<span style="color:#ff79c6">.</span><span style="color:#50fa7b">createDefault</span><span style="color:#ff79c6">();</span>
        HttpGet request <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> HttpGet<span style="color:#ff79c6">(</span>url<span style="color:#ff79c6">);</span>
        CloseableHttpResponse response <span style="color:#ff79c6">=</span> httpClient<span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span>request<span style="color:#ff79c6">);</span> <span style="color:#6272a4">// (1) HttpHostConnectException 발생
</span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">return</span> response<span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><p>먼저 로그를 확인해보았다.
해당 시간대에 IPInfoDB API 서버로 요청하는 부분에서
일시적으로 Connection Timeout이 발생했던 것을 확인할 수 있었다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#ff79c6">[</span>2022<span style="color:#ff79c6">-</span>05<span style="color:#ff79c6">-</span>09 06<span style="color:#ff79c6">:</span>32<span style="color:#ff79c6">:</span>57<span style="color:#ff79c6">:</span>8502224037446002723 2136207119638956779<span style="color:#ff79c6">]</span> ERROR org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">conn</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">HttpHostConnectException</span><span style="color:#ff79c6">:</span> Connect to api<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ipinfodb</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">com</span><span style="color:#ff79c6">:</span>80 <span style="color:#ff79c6">[</span>api<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ipinfodb</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">com</span><span style="color:#ff79c6">/</span>45<span style="color:#ff79c6">.</span><span style="color:#50fa7b">32</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">138</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">106</span><span style="color:#ff79c6">]</span> failed<span style="color:#ff79c6">:</span> 연결 시간 <span style="color:#50fa7b">초과</span> <span style="color:#ff79c6">(</span>Connection timed out<span style="color:#ff79c6">)</span>
org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">conn</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">HttpHostConnectException</span><span style="color:#ff79c6">:</span> Connect to api<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ipinfodb</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">com</span><span style="color:#ff79c6">:</span>80 <span style="color:#ff79c6">[</span>api<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ipinfodb</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">com</span><span style="color:#ff79c6">/</span>45<span style="color:#ff79c6">.</span><span style="color:#50fa7b">32</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">138</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">106</span><span style="color:#ff79c6">]</span> failed<span style="color:#ff79c6">:</span> 연결 시간 <span style="color:#50fa7b">초과</span> <span style="color:#ff79c6">(</span>Connection timed out<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">conn</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">DefaultHttpClientConnectionOperator</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connect</span><span style="color:#ff79c6">(</span>DefaultHttpClientConnectionOperator<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>159<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">conn</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">PoolingHttpClientConnectionManager</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connect</span><span style="color:#ff79c6">(</span>PoolingHttpClientConnectionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>373<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execchain</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MainClientExec</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">establishRoute</span><span style="color:#ff79c6">(</span>MainClientExec<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>394<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execchain</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MainClientExec</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span>MainClientExec<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>237<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execchain</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ProtocolExec</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span>ProtocolExec<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>185<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execchain</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">RetryExec</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span>RetryExec<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>89<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execchain</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">RedirectExec</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span>RedirectExec<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>110<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">client</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">InternalHttpClient</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">doExecute</span><span style="color:#ff79c6">(</span>InternalHttpClient<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>185<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">client</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">CloseableHttpClient</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span>CloseableHttpClient<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>83<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">client</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">CloseableHttpClient</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span>CloseableHttpClient<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>108<span style="color:#ff79c6">)</span>
        <span style="color:#ff79c6">...</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalina</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connector</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">CoyoteAdapter</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">service</span><span style="color:#ff79c6">(</span>CoyoteAdapter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>343<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">coyote</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http11</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Http11Processor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">service</span><span style="color:#ff79c6">(</span>Http11Processor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>798<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">coyote</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">AbstractProcessorLight</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">process</span><span style="color:#ff79c6">(</span>AbstractProcessorLight<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>66<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">coyote</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">AbstractProtocol$ConnectionHandler</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">process</span><span style="color:#ff79c6">(</span>AbstractProtocol<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>808<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">tomcat</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">util</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">NioEndpoint$SocketProcessor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">doRun</span><span style="color:#ff79c6">(</span>NioEndpoint<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>1498<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">tomcat</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">util</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SocketProcessorBase</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">run</span><span style="color:#ff79c6">(</span>SocketProcessorBase<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>49<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">util</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">concurrent</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ThreadPoolExecutor</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">runWorker</span><span style="color:#ff79c6">(</span>ThreadPoolExecutor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>1149<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">util</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">concurrent</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ThreadPoolExecutor$Worker</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">run</span><span style="color:#ff79c6">(</span>ThreadPoolExecutor<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>624<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">tomcat</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">util</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">threads</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">TaskThread$WrappingRunnable</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">run</span><span style="color:#ff79c6">(</span>TaskThread<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>61<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Thread</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">run</span><span style="color:#ff79c6">(</span>Thread<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>748<span style="color:#ff79c6">)</span>
Caused by<span style="color:#ff79c6">:</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ConnectException</span><span style="color:#ff79c6">:</span> 연결 시간 <span style="color:#50fa7b">초과</span> <span style="color:#ff79c6">(</span>Connection timed out<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">PlainSocketImpl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">socketConnect</span><span style="color:#ff79c6">(</span>Native Method<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">AbstractPlainSocketImpl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">doConnect</span><span style="color:#ff79c6">(</span>AbstractPlainSocketImpl<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>350<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">AbstractPlainSocketImpl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connectToAddress</span><span style="color:#ff79c6">(</span>AbstractPlainSocketImpl<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>206<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">AbstractPlainSocketImpl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connect</span><span style="color:#ff79c6">(</span>AbstractPlainSocketImpl<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>188<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SocksSocketImpl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connect</span><span style="color:#ff79c6">(</span>SocksSocketImpl<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>392<span style="color:#ff79c6">)</span>
        at java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Socket</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connect</span><span style="color:#ff79c6">(</span>Socket<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>589<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">conn</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">socket</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">PlainConnectionSocketFactory</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connectSocket</span><span style="color:#ff79c6">(</span>PlainConnectionSocketFactory<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>75<span style="color:#ff79c6">)</span>
        at org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">http</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">impl</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">conn</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">DefaultHttpClientConnectionOperator</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connect</span><span style="color:#ff79c6">(</span>DefaultHttpClientConnectionOperator<span style="color:#ff79c6">.</span><span style="color:#50fa7b">java</span><span style="color:#ff79c6">:</span>142<span style="color:#ff79c6">)</span>
        <span style="color:#ff79c6">...</span> 134 common frames omitted
</code></pre></div><p>로그에서 보듯이 HTTP 요청에 사용한 라이브러리는 <code>org.apache.httpcomponents.httpclient</code> 이며 Timeout 기본값이 <code>-1</code> 이다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#6272a4">// org.apache.http.client.config.RequestConfig
</span><span style="color:#6272a4"></span>connectionRequestTimeout <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1
connectTimeout <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1
socketTimeout <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1
</code></pre></div><p>해당 값들은 Connection Manager에서 <code>0</code>으로 설정된다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#6272a4">// org.apache.http.impl.execchain.MainClientExec
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connManager</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">connect</span><span style="color:#ff79c6">(</span>
        managedConn<span style="color:#ff79c6">,</span>
        route<span style="color:#ff79c6">,</span>
        timeout <span style="color:#ff79c6">&gt;</span> 0 <span style="color:#ff79c6">?</span> timeout <span style="color:#ff79c6">:</span> 0<span style="color:#ff79c6">,</span>
        context<span style="color:#ff79c6">);</span>
</code></pre></div><p><code>0</code>으로 설정된 커넥션 타임아웃은 발생하지 않기 때문에 끊기지 않고 계속 대기한다.
그러다가 트랜잭션 타임아웃이 발생하면서 커넥션이 끊긴 것이다.
데드락과 달리 연쇄 서버 장애는 아닌 셈이다.</p>
<h2 id="해결-2">해결 2</h2>
<p>네트워크 연결이 필요할 경우 반드시 Timeout 값을 설정해야 한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-java" data-lang="java"><span style="color:#8be9fd">int</span> timeout <span style="color:#ff79c6">=</span> 5<span style="color:#ff79c6">;</span>

RequestConfig config <span style="color:#ff79c6">=</span> RequestConfig<span style="color:#ff79c6">.</span><span style="color:#50fa7b">custom</span><span style="color:#ff79c6">()</span>
        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">setConnectTimeout</span><span style="color:#ff79c6">(</span>timeout <span style="color:#ff79c6">*</span> 1000<span style="color:#ff79c6">)</span>
        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">setConnectionRequestTimeout</span><span style="color:#ff79c6">(</span>timeout <span style="color:#ff79c6">*</span> 1000<span style="color:#ff79c6">)</span>
        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">setSocketTimeout</span><span style="color:#ff79c6">(</span>timeout <span style="color:#ff79c6">*</span> 1000<span style="color:#ff79c6">)</span>
        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>

HttpClient httpClient <span style="color:#ff79c6">=</span> 
    HttpClientBuilder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">create</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">setDefaultRequestConfig</span><span style="color:#ff79c6">(</span>config<span style="color:#ff79c6">).</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</code></pre></div><h1 id="결론">결론</h1>
<p>Timeout을 설정하지 않으면 데드락부터 연쇄 서버 장애까지 많은 것을 겪을 수 있다.
부디 Timeout 설정을 잊지 말고 이것을 관찰할 수 있도록 유의미한 로깅과 모니터링을 하자! 🧑‍💻</p>
<h1 id="더-읽을-거리">더 읽을 거리</h1>
<h2 id="logging">Logging</h2>
<ul>
<li><a href="https://www.slipp.net/questions/350">Exception 처리 권고사안</a> - benelog</li>
<li><a href="https://gmlwjd9405.github.io/2019/01/04/logging-with-slf4j.html">SLF4J를 이용한 Logging</a> - heejeong Kwon</li>
<li><a href="https://xlffm3.github.io/spring%20&amp;%20spring%20boot/async-logger-performance/">Log4j2 및 Logback의 Async Logging 성능 테스트 비교</a> - Jinhong</li>
</ul>
<h2 id="monitoring-1">Monitoring</h2>
<ul>
<li><a href="https://www.44bits.io/ko/keyword/datadog">데이터독(Datadog)이란?</a> - 44bits</li>
<li><a href="https://www.datadoghq.com/blog/alerting-101-metric-checks/">Alerting 101: Timeseries metric checks</a> - Datadog</li>
<li><a href="https://www.datadoghq.com/blog/introducing-recovery-thresholds/">Introducing recovery thresholds for metric alerts</a> - Datadog</li>
<li><a href="https://docs.datadoghq.com/tracing/guide/week_over_week_p50_comparison/">Compare a Service’s latency to the previous week</a> - Datadog</li>
<li><a href="https://engineering.linecorp.com/ko/blog/line-failure-reporting-and-follow-up-process-culture/">LINE의 장애 보고와 후속 절차 문화</a> - LINE Engineering</li>
</ul>
<h2 id="transaction">Transaction</h2>
<ul>
<li><a href="https://docs.spring.io/spring-framework/docs/5.3.2/reference/html/data-access.html#transaction">Data Access - Transaction Management</a> - Spring Docs
<ul>
<li><a href="https://godekdls.github.io/Spring%20Data%20Access/transactionmanagement/">번역</a> - 토리맘의 한글라이즈 프로젝트</li>
</ul>
</li>
<li><a href="https://techblog.woowahan.com/2606/">응? 이게 왜 롤백되는거지?</a> - 우아한형제들 기술 블로그</li>
<li><a href="https://techblog.woowahan.com/2664/">HikariCP Dead lock에서 벗어나기 (이론편)</a> - 우아한형제들 기술 블로그</li>
<li><a href="https://techblog.woowahan.com/2663/">HikariCP Dead lock에서 벗어나기 (실전편)</a> - 우아한형제들 기술 블로그</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">최종 수정: 2022-05-11</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/java/jvm-monitoring/">
			다음글<br>JVM 모니터링
                </a>
                
                
                
                <a class="older-posts" href="/posts/shell/git-commands/">
			이전글<br>CLI 환경에서 소스 코드 관리하기
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://markruler.github.io/">
    
        <div class="nav-title">
            임창수 블로그
        </div>
        
        <div class="nav-subtitle">
            What, Why, How.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Posts
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Im Changsu 2020 - 2024
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 목차 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%83%81%ed%99%a9" class="nav-상황">
									상황
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%eb%b6%84%ec%84%9d" class="nav-분석">
									분석
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ed%95%b4%ea%b2%b0" class="nav-해결">
									해결
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#sql-%ed%8a%9c%eb%8b%9d" class="nav-sql-튜닝">
									SQL 튜닝
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#timeout-%ec%84%a4%ec%a0%95" class="nav-timeout-설정">
									Timeout 설정
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ec%b6%94%ea%b0%80%ec%a0%81%ec%9d%b8-%eb%ac%b8%ec%a0%9c" class="nav-추가적인-문제">
									추가적인 문제
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#monitoring" class="nav-monitoring">
									Monitoring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#log-tracing--error-tracking" class="nav-log-tracing--error-tracking">
									Log Tracing &amp; Error Tracking
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#spring-aop" class="nav-spring-aop">
									Spring AOP
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ec%83%81%ed%99%a9-2" class="nav-상황-2">
									상황 2
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%eb%b6%84%ec%84%9d-2" class="nav-분석-2">
									분석 2
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ed%95%b4%ea%b2%b0-2" class="nav-해결-2">
									해결 2
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ea%b2%b0%eb%a1%a0" class="nav-결론">
									결론
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%8d%94-%ec%9d%bd%ec%9d%84-%ea%b1%b0%eb%a6%ac" class="nav-더-읽을-거리">
									더 읽을 거리
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#logging" class="nav-logging">
									Logging
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#monitoring-1" class="nav-monitoring-1">
									Monitoring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#transaction" class="nav-transaction">
									Transaction
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Im Changsu 2020 - 2024
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
