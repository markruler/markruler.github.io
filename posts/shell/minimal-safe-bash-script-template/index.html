<!DOCTYPE html>
<html lang="ko"><head>

<title>
  
  임창수
  
  | 최소한의 안전한 Bash 스크립트 템플릿
  
  
</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="Maciej Radzikowski">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">
<link rel="manifest" href="/manifest.json">



<meta property="og:url" content="https://markruler.github.io/posts/shell/minimal-safe-bash-script-template/">
  <meta property="og:site_name" content="임창수">
  <meta property="og:title" content="최소한의 안전한 Bash 스크립트 템플릿">
  <meta property="og:description" content="Maciej Radzikowski">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-02-14T15:22:00+09:00">
    <meta property="article:modified_time" content="2021-02-14T15:22:00+09:00">
    <meta property="article:tag" content="Bash">
    <meta property="article:tag" content="Shell">
    <meta property="article:tag" content="Translate">
    <meta property="og:image" content="https://markruler.github.io/images/shell/minimal-safe-bash-script-template.png">






  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://markruler.github.io/images/shell/minimal-safe-bash-script-template.png">
  <meta name="twitter:title" content="최소한의 안전한 Bash 스크립트 템플릿">
  <meta name="twitter:description" content="Maciej Radzikowski">











  




<link rel="icon" href="https://markruler.github.io/images/favicon.ico">




      <script defer src="/js/toc.js"></script>
    
    
    
  
  
  <link rel="stylesheet" href="/scss/dark-mode.min.8fc48c2ea7be95e8c4464eeff8bc5136ea3f3a258f6cdba7e220dfab2ab7f35f.css" integrity="sha256-j8SMLqe&#43;lejERk7v&#43;LxRNuo/OiWPbNun4iDfqyq3818=" media="screen">




















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Posts
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 목차 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bash%ec%97%90%ec%84%9c-%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8c%85-%ed%95%98%eb%8a%94-%ec%9d%b4%ec%9c%a0" class="nav-bash에서-스크립팅-하는-이유">
									Bash에서 스크립팅 하는 이유
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bash-%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8-%ed%85%9c%ed%94%8c%eb%a6%bf" class="nav-bash-스크립트-템플릿">
									Bash 스크립트 템플릿
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bash-%ec%84%a0%ed%83%9d%ed%95%98%ea%b8%b0" class="nav-bash-선택하기">
									Bash 선택하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%b9%a0%eb%a5%b4%ea%b2%8c-%ec%8b%a4%ed%8c%a8%ed%95%98%ea%b8%b0" class="nav-빠르게-실패하기">
									빠르게 실패하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%9c%84%ec%b9%98-%ea%b0%80%ec%a0%b8%ec%98%a4%ea%b8%b0" class="nav-위치-가져오기">
									위치 가져오기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%a0%95%eb%a6%ac%ed%95%98%ea%b8%b0" class="nav-정리하기">
									정리하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%8f%84%ec%9b%80%eb%90%98%eb%8a%94-%eb%8f%84%ec%9b%80%eb%a7%90-%ed%91%9c%ec%8b%9c%ed%95%98%ea%b8%b0" class="nav-도움되는-도움말-표시하기">
									도움되는 도움말 표시하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%a0%81%ec%a0%88%ed%95%9c-%eb%a9%94%ec%8b%9c%ec%a7%80-%ec%b6%9c%eb%a0%a5%ed%95%98%ea%b8%b0" class="nav-적절한-메시지-출력하기">
									적절한 메시지 출력하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%aa%a8%eb%93%a0-%ed%8c%8c%eb%9d%bc%eb%af%b8%ed%84%b0-%ed%8c%8c%ec%8b%b1" class="nav-모든-파라미터-파싱">
									모든 파라미터 파싱
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ed%85%9c%ed%94%8c%eb%a6%bf-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0" class="nav-템플릿-사용하기">
									템플릿 사용하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%9d%b4%ec%8b%9d%ec%84%b1-portability" class="nav-이식성-portability">
									이식성 (Portability)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%8d%94-%ec%9d%bd%ec%9d%84-%ea%b1%b0%eb%a6%ac" class="nav-더-읽을-거리">
									더 읽을 거리
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%81%9d%eb%a7%ba%ec%9d%8c" class="nav-끝맺음">
									끝맺음
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8-2020-12-15" class="nav-업데이트-2020-12-15">
									업데이트 2020-12-15
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8-2020-12-16" class="nav-업데이트-2020-12-16">
									업데이트 2020-12-16
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            📜
        </button>
        <a id="navTitle" class="navbar-brand" href="https://markruler.github.io/">
            임창수
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            🌙
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
    v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <button
        class="read-random-mobile"
        data-target-prefix="/posts">
        Navigate to Random Post
    </button>
    <a href="https://markruler.github.io/">
        <div class="single-column-header-title">임창수</div>
        
        <div class="single-column-header-subtitle">What, Why, How.</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    최소한의 안전한 Bash 스크립트 템플릿
                    
                    <div class="post-subtitle">
                        Maciej Radzikowski
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-02-14 15:22
                        </time>
                        

                        
                            <a href="/categories/wiki">[wiki]</a>
                            &nbsp;
                        

                        
                            
                                <a href="/tags/bash">bash</a>
                                &nbsp;
                            
                                <a href="/tags/shell">shell</a>
                                &nbsp;
                            
                                <a href="/tags/translate">translate</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <blockquote>
<ul>
<li><a href="https://twitter.com/radzikowski_m">Maciej Radzikowski</a>가 작성한 <a href="https://betterdev.blog/minimal-safe-bash-script-template/">Minimal safe Bash script template (2020-12-14)</a>를 번역한 글입니다.</li>
<li>저자의 허락을 받고 번역했습니다.</li>
</ul></blockquote>
<p>Bash 스크립트.
거의 모든 사람들이 언젠가 작성해야 하는 것입니다.
하지만 그 중 누구도 &ldquo;맞아요, 저는 Bash 스크립트 작성하는 것을 사랑합니다&quot;라고 말하지 않습니다.
거의 모든 사람들이 Bash 스크립트를 작성할 때 주의를 기울이지 않는 이유죠.</p>
<p>저는 여러분을 Bash 전문가로 만들려는 것이 아닙니다 (저도 전문가는 아닙니다).
다만 스크립트를 더 안전하게 만들어 줄 최소한의 템플릿을 보여 드리겠습니다.
저에게 감사해하실 필요는 없어요. 여러분의 미래가 여러분에게 감사해할 것입니다.</p>
<h1 id="bash에서-스크립팅-하는-이유">Bash에서 스크립팅 하는 이유</h1>
<p>Bash 스크립팅에 대한 가장 좋은 설명이 최근 저의 트위터 피드에 나타났습니다.</p>
<blockquote>
<p>&ldquo;자전거 타는 거랑 비슷해&quot;의 반대말은 &ldquo;bash 프로그래밍이랑 비슷해&quot;이다.<br>
몇 번을 했던지 상관없이 매번 다시 배워야 한다는 말.<br>
<br>
- <a href="https://twitter.com/JakeWharton/status/1334177665356587008">Jake Wharton</a></p></blockquote>
<p>하지만 Bash는 널리 사랑받는 언어인 JavaScript처럼 쉽게 사라지지 않을 것입니다.
주요 언어가 되지 않길 바라더라도 Bash는 항상 우리와 가까운 곳에 있습니다.</p>
<p>Bash는 <a href="https://www.quora.com/Is-Bash-considered-the-lingua-franca-of-shells/answer/Paul-Reiber">셸(shell) 왕좌를 물려받았고</a>
Docker 이미지를 포함한 거의 모든 Linux에서 찾을 수 있습니다.
이는 대부분의 백엔드가 실행되는 환경입니다.
따라서 서버 애플리케이션 시작, CI/CD 또는 통합 테스트 실행을
스크립팅해야 하는 경우 Bash를 사용하면 됩니다.</p>
<p>몇 가지 명령을 이어 붙이고, 출력을 다른 명령으로 전달하고,
실행 파일을 시작하기 위해 Bash는 가장 쉽고 가장 기본적인 솔루션입니다.
더 크고 복잡한 스크립트를 다른 언어로 작성하는 것은 매우 타당한 일이지만
Python, Ruby, fish 또는 다른 인터프리터가 어디에서나 사용할 수 있을 것이라고 기대할 수는 없습니다.
또한 일부 프로덕션 서버, Docker 이미지 또는 CI 환경에 이 언어들을 추가하려면
두 번 생각해보고 또 다시 한 번 생각해 보아야 합니다.</p>
<p>하지만 Bash는 완벽하지 않습니다.
문법은 최악이고 에러 핸들링도 어렵습니다.
우리가 해결해야 하는 지뢰가 널려 있죠.</p>
<h1 id="bash-스크립트-템플릿">Bash 스크립트 템플릿</h1>
<p>거두절미하고 템플릿은 다음과 같습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#e5e5e5">#!/usr/bin/env bash
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5"></span>
</span></span><span style="display:flex;"><span>set -Eeuo pipefail
</span></span><span style="display:flex;"><span>trap cleanup SIGINT SIGTERM ERR EXIT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eedd82">script_dir</span>=<span style="color:#f00">$(</span>cd <span style="color:#87ceeb">&#34;</span><span style="color:#f00">$(</span>dirname <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">BASH_SOURCE</span>[0]<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span><span style="color:#f00">)</span><span style="color:#87ceeb">&#34;</span> &amp;&gt;/dev/null &amp;&amp; pwd -P<span style="color:#f00">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>usage() {
</span></span><span style="display:flex;"><span>  cat <span style="color:#87ceeb">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">Usage: $(basename &#34;${BASH_SOURCE[0]}&#34;) [-h] [-v] [-f] -p param_value arg1 [arg2...]
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">Script description here.
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">Available options:
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">-h, --help      Print this help and exit
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">-v, --verbose   Print script debug info
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">-f, --flag      Some flag description
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">-p, --param     Some param description
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">EOF</span>
</span></span><span style="display:flex;"><span>  exit
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cleanup() {
</span></span><span style="display:flex;"><span>  trap - SIGINT SIGTERM ERR EXIT
</span></span><span style="display:flex;"><span>  <span style="color:#0f0"># script cleanup here</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>setup_colors() {
</span></span><span style="display:flex;"><span>  <span style="color:#f00">if</span> [[ -t <span style="color:#f60">2</span> ]] &amp;&amp; [[ -z <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">NO_COLOR</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> ]] &amp;&amp; [[ <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">TERM</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> != <span style="color:#87ceeb">&#34;dumb&#34;</span> ]]; <span style="color:#f00">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eedd82">NOFORMAT</span>=<span style="color:#87ceeb">&#39;\033[0m&#39;</span> <span style="color:#eedd82">RED</span>=<span style="color:#87ceeb">&#39;\033[0;31m&#39;</span> <span style="color:#eedd82">GREEN</span>=<span style="color:#87ceeb">&#39;\033[0;32m&#39;</span> <span style="color:#eedd82">ORANGE</span>=<span style="color:#87ceeb">&#39;\033[0;33m&#39;</span> <span style="color:#eedd82">BLUE</span>=<span style="color:#87ceeb">&#39;\033[0;34m&#39;</span> <span style="color:#eedd82">PURPLE</span>=<span style="color:#87ceeb">&#39;\033[0;35m&#39;</span> <span style="color:#eedd82">CYAN</span>=<span style="color:#87ceeb">&#39;\033[0;36m&#39;</span> <span style="color:#eedd82">YELLOW</span>=<span style="color:#87ceeb">&#39;\033[1;33m&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eedd82">NOFORMAT</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">RED</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">GREEN</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">ORANGE</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">BLUE</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">PURPLE</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">CYAN</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">YELLOW</span>=<span style="color:#87ceeb">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">fi</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>msg() {
</span></span><span style="display:flex;"><span>  echo &gt;&amp;<span style="color:#f60">2</span> -e <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">1</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>die() {
</span></span><span style="display:flex;"><span>  local <span style="color:#eedd82">msg</span>=<span style="color:#eedd82">$1</span>
</span></span><span style="display:flex;"><span>  local <span style="color:#eedd82">code</span>=<span style="color:#87ceeb">${</span><span style="color:#eedd82">2</span>-1<span style="color:#87ceeb">}</span> <span style="color:#0f0"># default exit status 1</span>
</span></span><span style="display:flex;"><span>  msg <span style="color:#87ceeb">&#34;</span><span style="color:#eedd82">$msg</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>  exit <span style="color:#87ceeb">&#34;</span><span style="color:#eedd82">$code</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>parse_params() {
</span></span><span style="display:flex;"><span>  <span style="color:#0f0"># default values of variables set from params</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eedd82">flag</span>=<span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eedd82">param</span>=<span style="color:#87ceeb">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">while</span> :; <span style="color:#f00">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f00">case</span> <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">1</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> in
</span></span><span style="display:flex;"><span>    -h | --help) usage ;;
</span></span><span style="display:flex;"><span>    -v | --verbose) set -x ;;
</span></span><span style="display:flex;"><span>    --no-color) <span style="color:#eedd82">NO_COLOR</span>=<span style="color:#f60">1</span> ;;
</span></span><span style="display:flex;"><span>    -f | --flag) <span style="color:#eedd82">flag</span>=<span style="color:#f60">1</span> ;; <span style="color:#0f0"># example flag</span>
</span></span><span style="display:flex;"><span>    -p | --param) <span style="color:#0f0"># example named parameter</span>
</span></span><span style="display:flex;"><span>      <span style="color:#eedd82">param</span>=<span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">2</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>      shift
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    -?*) die <span style="color:#87ceeb">&#34;Unknown option: </span><span style="color:#eedd82">$1</span><span style="color:#87ceeb">&#34;</span> ;;
</span></span><span style="display:flex;"><span>    *) break ;;
</span></span><span style="display:flex;"><span>    <span style="color:#f00">esac</span>
</span></span><span style="display:flex;"><span>    shift
</span></span><span style="display:flex;"><span>  <span style="color:#f00">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#eedd82">args</span>=(<span style="color:#87ceeb">&#34;</span><span style="color:#eedd82">$@</span><span style="color:#87ceeb">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#0f0"># check required params and arguments</span>
</span></span><span style="display:flex;"><span>  [[ -z <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">param</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> ]] &amp;&amp; die <span style="color:#87ceeb">&#34;Missing required parameter: param&#34;</span>
</span></span><span style="display:flex;"><span>  [[ <span style="color:#87ceeb">${#</span><span style="color:#eedd82">args</span>[@]<span style="color:#87ceeb">}</span> -eq <span style="color:#f60">0</span> ]] &amp;&amp; die <span style="color:#87ceeb">&#34;Missing script arguments&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">return</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>parse_params <span style="color:#87ceeb">&#34;</span><span style="color:#eedd82">$@</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>setup_colors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># script logic here</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>msg <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">RED</span><span style="color:#87ceeb">}</span><span style="color:#87ceeb">Read parameters:</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">NOFORMAT</span><span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>msg <span style="color:#87ceeb">&#34;- flag: </span><span style="color:#87ceeb">${</span><span style="color:#eedd82">flag</span><span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>msg <span style="color:#87ceeb">&#34;- param: </span><span style="color:#87ceeb">${</span><span style="color:#eedd82">param</span><span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>msg <span style="color:#87ceeb">&#34;- arguments: </span><span style="color:#87ceeb">${</span><span style="color:#eedd82">args</span>[*]-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>
</span></span></code></pre></div><p>너무 길지 않게 만들려는 생각이었습니다.
저는 스크립트 로직때문에 500줄이나 스크롤하고 싶지 않습니다.
동시에 어떤 스크립트에서든 좋은 기반 스크립트가 되었으면 했습니다.
하지만 Bash는 의존성 관리라는 것이 없어서 쉽게 만들 수는 없었습니다.</p>
<p>한 가지 해결책은 처음부터 모든 보일러 플레이트 및 유틸리티
함수(function)가 있는 별도의 스크립트를 같이 실행시키는 것입니다.
이 방식의 단점은 &ldquo;간단한 Bash 스크립트&quot;라는 의도를 잃어버리고 항상
별도의 파일을 달고 다녀야 한다는 것입니다. 그래서 저는 템플릿을
가능한 한 짧게 만들기 위해 필수적인 것만을 템플릿에 넣자고 결정했습니다.</p>
<p>이제 좀 더 자세히 살펴보겠습니다.</p>
<h2 id="bash-선택하기">Bash 선택하기</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#e5e5e5">#!/usr/bin/env bash
</span></span></span></code></pre></div><p>스크립트는 기본적으로 셔뱅(shebang)<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>으로 시작합니다.
<a href="https://stackoverflow.com/questions/21612980/why-is-usr-bin-env-bash-superior-to-bin-bash">최적의 호환성</a>을 위해
<code>/bin/bash</code>가 아닌 <code>/usr/bin/env</code>를 참조합니다.
링크된 StackOverflow 질문의 답변을 읽어 보시면
이 경우에도 오류가 발생할 수는 있습니다.</p>
<h2 id="빠르게-실패하기">빠르게 실패하기</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>set -Eeuo pipefail
</span></span></code></pre></div><p><code>set</code> 명령어는 스크립트 실행 옵션을 변경합니다.
예를 들면 <strong>기본적으로 Bash는 일부 명령이 실패하는 것과 상관없이</strong>
0 외의 종료 상태 코드를 반환합니다. 다음 단계로 잘 넘어갑니다.
이제 다음과 같이 짧은 스크립트를 살펴보겠습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#e5e5e5">#!/usr/bin/env bash
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5"></span>cp important_file ./backups/
</span></span><span style="display:flex;"><span>rm important_file
</span></span></code></pre></div><p>여기서 <code>backups</code> 디렉토리가 존재하지 않을 경우 어떻게 될까요?
정확히 말하면 콘솔에 오류 메시지가 표시되지만
응답하기 전에 두 번째 명령에 의해 파일이 이미 제거됩니다.</p>
<p><code>set -Eeuo pipefail</code> 옵션들이 정확하게 무엇을 바꾸는지,
어떻게 사용자를 보호할 것인지에 대한 자세한 내용은
<a href="https://vaneyckt.io/posts/safer_bash_scripts_with_set_euxo_pipefail/">몇 년 동안 제 북마크에 있는 글</a>을 참조해주세요.</p>
<p>하지만 <a href="https://www.reddit.com/r/commandline/comments/g1vsxk/the_first_two_statements_of_your_bash_script/fniifmk/">이러한 옵션 설정에 대해 몇 가지 반론</a>이 있다는 것을 알고 있어야 합니다.</p>
<h2 id="위치-가져오기">위치 가져오기</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#eedd82">script_dir</span>=<span style="color:#f00">$(</span>cd <span style="color:#87ceeb">&#34;</span><span style="color:#f00">$(</span>dirname <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">BASH_SOURCE</span>[0]<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span><span style="color:#f00">)</span><span style="color:#87ceeb">&#34;</span> &amp;&gt;/dev/null &amp;&amp; pwd -P<span style="color:#f00">)</span>
</span></span></code></pre></div><p>이 줄은 스크립트가 위치한 디렉토리를 지정하는 데 가장 효과적이며, <del>여기에 <code>cd</code>를 붙입니다.</del></p>
<p>스크립트가 작업 디렉토리에 있다면 스크립트가 상대 경로로 동작하며
파일을 복사하고 명령어를 실행합니다.
동일한 디렉토리에서 스크립트를 실행하는 한 그렇습니다.</p>
<p>하지만 CI 구성에서 다음과 같은 스크립트를 실행한다면</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/opt/ci/project/script.sh
</span></span></code></pre></div><p>이 스크립트는 프로젝트 디렉토리가 아니라 CI 도구의 다른 작업 디렉토리에서 동작합니다.
스크립트를 실행하기 전에 해당 디렉토리로 이동함으로써 고칠 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /opt/ci/project &amp;&amp; ./script.sh
</span></span></code></pre></div><p>그래도 스크립트 쪽에서 해결하는 게 훨씬 좋습니다.
스크립트가 일부 파일을 읽거나 동일한 디렉터리에서
다른 프로그램을 실행하려는 경우 아래처럼 호출합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#87ceeb">&#34;</span><span style="color:#eedd82">$script_dir</span><span style="color:#87ceeb">/my_file&#34;</span>
</span></span></code></pre></div><p>동시에 스크립트는 작업 디렉토리 위치를 변경하지 않습니다.
스크립트가 다른 디렉토리에서 실행되어 사용자가 일부 파일에 대한
상대 경로를 제공하더라도 해당 스크립트를 읽을 수 있습니다.</p>
<h2 id="정리하기">정리하기</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>trap cleanup SIGINT SIGTERM ERR EXIT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cleanup() {
</span></span><span style="display:flex;"><span>  trap - SIGINT SIGTERM ERR EXIT
</span></span><span style="display:flex;"><span>  <span style="color:#0f0"># script cleanup here</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>스크립트의 <code>trap</code>을 <code>finally</code> 블록으로 생각해 보세요.
보통 오류나 외부 신호에 의해 스크립트가 끝나면 <code>cleanup()</code> 함수가 실행됩니다.
예를 들어 스크립트가 생성한 모든 임시 파일들을 제거할 수 있습니다.</p>
<p><code>cleanup()</code>은 끝날 때뿐만 아니라 스크립트가 특정 부분만 제거할 수도 있다는 것을 기억하세요.
제거하려는 자원이 반드시 있어야 하는 것은 아닙니다.</p>
<h2 id="도움되는-도움말-표시하기">도움되는 도움말 표시하기</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>usage() {
</span></span><span style="display:flex;"><span>  cat <span style="color:#87ceeb">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">Usage: $(basename &#34;${BASH_SOURCE[0]}&#34;) [-h] [-v] [-f] -p param_value arg1 [arg2...]
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">Script description here.
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">...
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb">EOF</span>
</span></span><span style="display:flex;"><span>  exit
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>usage()</code> 함수가 상대적으로 스크립트 상단에 있을 경우 다음 두 가지 방식으로 동작합니다.</p>
<ul>
<li>모든 옵션을 아는 것도 아니면서 스크립트 전체를 보고 싶지 않은 사용자를 위해 <code>도움말을 표시합니다</code>.</li>
<li>스크립트 수정 시 <code>최소한의 문서</code>입니다. (예: 2주 후, 무엇을 작성했는지 떠올릴 필요가 없습니다)</li>
</ul>
<p>여기에 모든 함수를 기록해야 한다고 말하는 것은 아닙니다.
그러나 짧고 적절한 스크립트 사용법(usage) 메시지는 필수 항목입니다.</p>
<h2 id="적절한-메시지-출력하기">적절한 메시지 출력하기</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>setup_colors() {
</span></span><span style="display:flex;"><span>  <span style="color:#f00">if</span> [[ -t <span style="color:#f60">2</span> ]] &amp;&amp; [[ -z <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">NO_COLOR</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> ]] &amp;&amp; [[ <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">TERM</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> != <span style="color:#87ceeb">&#34;dumb&#34;</span> ]]; <span style="color:#f00">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eedd82">NOFORMAT</span>=<span style="color:#87ceeb">&#39;\033[0m&#39;</span> <span style="color:#eedd82">RED</span>=<span style="color:#87ceeb">&#39;\033[0;31m&#39;</span> <span style="color:#eedd82">GREEN</span>=<span style="color:#87ceeb">&#39;\033[0;32m&#39;</span> <span style="color:#eedd82">ORANGE</span>=<span style="color:#87ceeb">&#39;\033[0;33m&#39;</span> <span style="color:#eedd82">BLUE</span>=<span style="color:#87ceeb">&#39;\033[0;34m&#39;</span> <span style="color:#eedd82">PURPLE</span>=<span style="color:#87ceeb">&#39;\033[0;35m&#39;</span> <span style="color:#eedd82">CYAN</span>=<span style="color:#87ceeb">&#39;\033[0;36m&#39;</span> <span style="color:#eedd82">YELLOW</span>=<span style="color:#87ceeb">&#39;\033[1;33m&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eedd82">NOFORMAT</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">RED</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">GREEN</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">ORANGE</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">BLUE</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">PURPLE</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">CYAN</span>=<span style="color:#87ceeb">&#39;&#39;</span> <span style="color:#eedd82">YELLOW</span>=<span style="color:#87ceeb">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">fi</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>msg() {
</span></span><span style="display:flex;"><span>  echo &gt;&amp;<span style="color:#f60">2</span> -e <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">1</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>먼저 텍스트에서 색상을 사용하지 않으려면 <code>setup_colors()</code> 함수를 지우세요.
하지만 저는 매번 코드를 구글에다 검색하지 않는다면
색상을 더 자주 사용할 수 있다는 것을 알기 때문에 지우지 않습니다.</p>
<p>둘째로, 이러한 <strong>색상은 <code>msg()</code> 함수에만 사용하도록 되어 있고</strong> <code>echo</code> 명령에는 사용되지 않습니다.</p>
<p><code>msg()</code> 함수는 스크립트 출력을 제외한 모든 것을 출력하는 데 사용됩니다.
여기에는 오류뿐만 아니라 모든 로그와 메시지가 포함됩니다.
<a href="https://medium.com/@jdxcode/12-factor-cli-apps-dd3c227a0e46">12 팩터 CLI 앱</a>이라는 좋은 글을 인용합니다.</p>
<blockquote>
<p><strong><em>요컨대 stdout은 출력용이고 stderr는 메시지용입니다.</em></strong></p>
<p><a href="https://jdxcode.com/">Jeff Dickey</a>, who <a href="https://github.com/oclif/oclif/graphs/contributors">knows a little</a> about <a href="https://github.com/heroku/cli/graphs/contributors">building CLI apps</a></p></blockquote>
<p>그래서 대부분의 경우 <code>stdout</code>에 색상을 사용하지 않는 것이 좋습니다.</p>
<p><code>msg()</code>로 출력된 메시지는 <code>stderr</code> 스트림으로 전송되며 색상과 같은 특수 시퀀스를 지원합니다.
또한 <code>stderr</code> 출력이 대화형 터미널이 아니거나 <a href="https://no-color.org/">표준 파라미터 중 하나</a>가 전달되면 색상이 비활성화됩니다.</p>
<p>사용법:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msg <span style="color:#87ceeb">&#34;This is a </span><span style="color:#87ceeb">${</span><span style="color:#eedd82">RED</span><span style="color:#87ceeb">}</span><span style="color:#87ceeb">very important</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">NOFORMAT</span><span style="color:#87ceeb">}</span><span style="color:#87ceeb"> message, but not a script output value!&#34;</span>
</span></span></code></pre></div><p><code>stderr</code>가 대화형 터미널이 아닐 때 어떻게 작동하는지 확인하려면 스크립트에 위와 같은 줄을 추가하세요.
그런 다음 <code>stderr</code>를 <code>stdout</code>으로 리다이렉션하고 cat에 보내줍니다(pipe).
파이프가 동작하면 출력이 더 이상 터미널로 직접 전송되지 않고 다음 명령으로
전송되므로 이제 색상을 사용하지 않도록 설정해야 합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./test.sh 2&gt;&amp;<span style="color:#f60">1</span> | cat
</span></span><span style="display:flex;"><span>This is a very important message, but not a script output value!
</span></span></code></pre></div><h2 id="모든-파라미터-파싱">모든 파라미터 파싱</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>parse_params() {
</span></span><span style="display:flex;"><span>  <span style="color:#0f0"># default values of variables set from params</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eedd82">flag</span>=<span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eedd82">param</span>=<span style="color:#87ceeb">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">while</span> :; <span style="color:#f00">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f00">case</span> <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">1</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> in
</span></span><span style="display:flex;"><span>    -h | --help) usage ;;
</span></span><span style="display:flex;"><span>    -v | --verbose) set -x ;;
</span></span><span style="display:flex;"><span>    --no-color) <span style="color:#eedd82">NO_COLOR</span>=<span style="color:#f60">1</span> ;;
</span></span><span style="display:flex;"><span>    -f | --flag) <span style="color:#eedd82">flag</span>=<span style="color:#f60">1</span> ;; <span style="color:#0f0"># example flag</span>
</span></span><span style="display:flex;"><span>    -p | --param) <span style="color:#0f0"># example named parameter</span>
</span></span><span style="display:flex;"><span>      <span style="color:#eedd82">param</span>=<span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">2</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>
</span></span><span style="display:flex;"><span>      shift
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    -?*) die <span style="color:#87ceeb">&#34;Unknown option: </span><span style="color:#eedd82">$1</span><span style="color:#87ceeb">&#34;</span> ;;
</span></span><span style="display:flex;"><span>    *) break ;;
</span></span><span style="display:flex;"><span>    <span style="color:#f00">esac</span>
</span></span><span style="display:flex;"><span>    shift
</span></span><span style="display:flex;"><span>  <span style="color:#f00">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#eedd82">args</span>=(<span style="color:#87ceeb">&#34;</span><span style="color:#eedd82">$@</span><span style="color:#87ceeb">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#0f0"># check required params and arguments</span>
</span></span><span style="display:flex;"><span>  [[ -z <span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">${</span><span style="color:#eedd82">param</span>-<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> ]] &amp;&amp; die <span style="color:#87ceeb">&#34;Missing required parameter: param&#34;</span>
</span></span><span style="display:flex;"><span>  [[ <span style="color:#87ceeb">${#</span><span style="color:#eedd82">args</span>[@]<span style="color:#87ceeb">}</span> -eq <span style="color:#f60">0</span> ]] &amp;&amp; die <span style="color:#87ceeb">&#34;Missing script arguments&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">return</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>스크립트에서 파라미터로 만들어야 하는 것이 있다면, 저는 보통 그렇게 합니다.
스크립트가 한 곳에서만 사용되더라도 마찬가지입니다.
이렇게 하면 복사 및 재사용이 쉬워지며, 이 작업은 종종 더 빠릅니다.
또한 하드 코딩이 필요한 부분이 있더라도 일반적으로 Bash 스크립트보다 더 높은 수준입니다.</p>
<p>플래그(flags), 지정된 파라미터(named parameters, keyword arguments) 및 위치 인자(positional arguments)라는
<a href="https://betterdev.blog/command-line-arguments-anatomy-explained/">세 가지 주요 CLI 파라미터 유형</a>이 있습니다<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.
<code>parse_params()</code> 함수는 모두 지원합니다.</p>
<p>여기서 처리되지 않는 유일한 공통 파라미터 패턴은
<a href="https://betterdev.blog/command-line-arguments-anatomy-explained/#flags_and_named_arguments">여러 개의 단일 문자 플래그를 연결하는</a> 것입니다.
<code>-a -b</code>처럼 두 개의 플래그가 아닌 <code>-ab</code>로 전달하려면 추가 코드가 필요합니다.</p>
<p><code>while</code> 루프는 파라미터들을 수동으로 파싱하는 방법입니다.
다른 모든 언어에서는 <a href="https://docs.python.org/3/library/argparse.html">내장 파서</a>
또는 <a href="https://yargs.js.org/">사용 가능한 라이브러리</a>를 사용해야 합니다.
하지만 우리가 사용하려는 것은 Bash입니다.</p>
<p>템플릿에 플래그(<code>-f</code>)와 지정된 파라미터(<code>-p</code>)가 예시로 있습니다.
다른 파라미터를 추가하기 위해서는 변경하거나 복사하기만 하면 됩니다.
그후 잊지 말고 <code>usage()</code> 함수를 업데이트하세요.</p>
<p>여기서 중요한 것은 <strong>알 수 없는 옵션에 오류를 던지는 것</strong>입니다.
Bash 인자 파싱에 대한 Google 검색 결과를 보면 일반적으로 놓치는 것입니다.
스크립트가 알 수 없는 옵션을 받았다는 것은 스크립트가 수행할 수
없는 작업을 사용자는 수행하기를 원했음을 의미합니다.
따라서 사용자의 기대와 스크립트 동작은 상당히 다를 수 있습니다.
좋지 않은 일이 일어나기 전에 실행을 아예 막는 것이 좋습니다.</p>
<p>Bash에는 파라미터를 파싱하는 두 가지 대안이 있습니다. <code>getopt</code>와 <code>getopts</code>입니다.
이 명령어들을 사용하는 것에 대한 <a href="https://unix.stackexchange.com/questions/62950/getopt-getopts-or-manual-parsing-what-to-use-when-i-want-to-support-both-shor">찬성과 반대 의견</a>이 있습니다.
기본적으로 macOS의 <code>getopt</code>가 <a href="https://stackoverflow.com/questions/11777695/why-the-getopt-doesnt-work-well-in-my-mac-os">완전히 다르게 동작</a>하고,
<code>getopts</code>가 긴 파라미터(예: <code>--help</code>)를 지원하지 않기 때문에 이러한 도구가 최선은 아니라는 것을 알게 되었습니다.</p>
<h1 id="템플릿-사용하기">템플릿 사용하기</h1>
<p>인터넷에서 찾을 수 있는 대부분의 코드처럼 복사-붙여넣기만 하면 됩니다.</p>
<p>음, 사실은 말하자면요.
Bash를 사용하면 <code>npm install</code>과 같은 범용 기능이 없습니다.</p>
<p>복사한 후에는 4가지 항목만 변경하면 됩니다.</p>
<ul>
<li>스크립트에 대한 설명이 있는 <code>usage()</code> 텍스트</li>
<li>관련 내용 <code>cleanup()</code></li>
<li><code>parse_params()</code>의 파라미터 - <code>--help</code>와 <code>--no-color</code>는 그대로 두고 예시(<code>-f</code>, <code>-p</code>)는 변경하세요.</li>
<li>실제 스크립트 로직</li>
</ul>
<h1 id="이식성-portability">이식성 (Portability)</h1>
<p>MacOS (기본적으로 구식 Bash 3.2)와 몇몇의 Docker 이미지에서 템플릿을 테스트했습니다.
Debian, Ubuntu, CentOS, Amazon Linux, Fedora입니다. 제대로 동작합니다.</p>
<p>분명히 Alpine Linux와 같은 Bash가 빠진 환경에서는 작동하지 않을 것입니다.
Alpine은 미니멀리즘 시스템으로서 매우 가벼운 ash (Almquist shell)를 사용합니다.</p>
<p>거의 모든 곳에서 작동하는
<a href="https://en.wikipedia.org/wiki/Bourne_shell">본 셸</a>(Bourne shell, <code>/bin/sh</code>)
호환 스크립트를 사용하는 것이 좋지 않냐고 질문할 수 있습니다.
적어도 저에게는 그렇지 않습니다.
Bash는 (아직도 사용하기 쉽지 않지만) 더 안전하고 강력하기 때문에
거의 다룰 일 없는 몇 가지 리눅스 배포판을 지원하지 않는 것 정도는 받아들일 수 있습니다.</p>
<h1 id="더-읽을-거리">더 읽을 거리</h1>
<p>Bash 또는 기타 <del>더 나은</del> 언어로 CLI 스크립트를 만들 때 몇 가지 범용 규칙이 있습니다.
다음 자료들은 작은 스크립트와 대형 CLI 애플리케이션을 안정적으로 만드는 방법으로 안내합니다.</p>
<ul>
<li><a href="https://clig.dev/">명령행 인터페이스 가이드라인</a></li>
<li><a href="https://medium.com/@jdxcode/12-factor-cli-apps-dd3c227a0e46">12 팩터 CLI 앱</a></li>
<li><a href="https://betterdev.blog/command-line-arguments-anatomy-explained/">예시를 들어 설명하는 명령행 인자 구조</a></li>
</ul>
<h1 id="끝맺음">끝맺음</h1>
<p>제가 Bash 스크립트 템플릿을 만든 첫 번째이자 마지막이 아닙니다.
좋은 대안 중 하나는 <a href="https://github.com/ralish/bash-script-template">이 프로젝트</a>입니다.
비록 제가 매일 필요로 하는 것에 비해 조금 크긴 하지만요.
결국 저는 Bash 스크립트를 가능한 한 작게 (그리고 희한하게) 유지하려고 노력합니다.</p>
<p>Bash 스크립트를 작성할 때 JetBrains IDE와 같이
<a href="https://github.com/koalaman/shellcheck">ShellCheck</a> 린터를 지원하는 IDE를 사용하십시오.
이것은 당신에게 역효과를 줄 수 있는 <a href="https://github.com/koalaman/shellcheck/blob/master/README.md#user-content-gallery-of-bad-code">많은 것</a>들을 하지 못하게 할 것입니다.</p>
<p>저의 Bash 스크립트 템플릿은 GitHub Gist(MIT 라이센스)처럼 사용할 수 있습니다.</p>
<p><a href="https://gist.github.com/m-radzikowski/53e0b39e9a59a1518990e76c2bff8038">script-template.sh</a></p>
<p>템플릿에 문제가 있거나 중요한 항목이 빠졌다고 생각되면 <a href="https://betterdev.blog/minimal-safe-bash-script-template/">코멘트</a>로 알려 주세요.</p>
<h2 id="업데이트-2020-12-15">업데이트 2020-12-15</h2>
<p><a href="https://www.reddit.com/r/programming/duplicates/kcxnag/minimal_safe_bash_script_template/">Reddit</a>과
<a href="https://news.ycombinator.com/item?id=25428621">HackerNews</a>에서 많은 코멘트를 받은 후
템플릿을 개선했습니다.
개정 이력을 <a href="https://gist.github.com/m-radzikowski/53e0b39e9a59a1518990e76c2bff8038">gist</a>에서 확인하세요.</p>
<h2 id="업데이트-2020-12-16">업데이트 2020-12-16</h2>
<p>이 게시물에 대한 링크는 <a href="https://news.ycombinator.com/front?day=2020-12-15">Hacker News의 첫 페이지(#7)</a>에 도달했습니다.
상상도 못한 일이었습니다.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://ko.wikipedia.org/wiki/%EC%85%94%EB%B1%85">셔뱅</a>이란 해시 기호와 느낌표(<code>#!</code>)로 이루어진 문자 시퀀스로 인터프리터 지시자(interpreter directive)를 지정합니다. 지정하려는 인터프리터 프로그램은 절대경로로 표시합니다.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>간단히 말하면,
&lsquo;플래그&rsquo;는 <code>true</code>, <code>false</code>를 인자로 받으며 <code>true</code>일 경우 생략할 수 있습니다.
&lsquo;지정된 파라미터&rsquo;는 파라미터와 함께 특정 값을 인자로 지정해야 합니다.
&lsquo;위치 인자&rsquo;는 인자를 적합한 위치에 지정해야 합니다.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">최종 수정: 2021-02-14</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/container/container-study-guide/">
			다음글<br>컨테이너 톺아보기
                </a>
                
                
                
                <a class="older-posts" href="/posts/kubernetes/level-triggering-and-reconciliation/">
			이전글<br>쿠버네티스 레벨 트리거링 및 조정
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












            </div>

            





<section class="social-share">
  <ul class="share-icons">
    
    
    <li>
      <a href="https://twitter.com/intent/tweet?hashtags=markruler,dev&amp;url=https%3a%2f%2fmarkruler.github.io%2fposts%2fshell%2fminimal-safe-bash-script-template%2f&amp;text=%ec%b5%9c%ec%86%8c%ed%95%9c%ec%9d%98%20%ec%95%88%ec%a0%84%ed%95%9c%20Bash%20%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8%20%ed%85%9c%ed%94%8c%eb%a6%bf" target="_blank" rel="noopener" aria-label="Share on Twitter" class="share-btn twitter">
        <svg xmlns:xlink="http://www.w3.org/1999/xlink" id="twitter" viewBox="0 0 48 48" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">bg</title>
    <circle cx="24" cy="24" fill="#1CB7EB" r="24" style="pointer-events:inherit" id="svg_1"></circle>
    <path d="M36.8,15.4C35.9,15.9 34.8,16.2 33.8,16.3C34.9,15.6 35.7,14.5 36.1,13.2C35.1,13.8 34,14.3 32.7,14.6C31.7,13.5 30.4,12.8 28.9,12.8C26,12.8 23.6,15.3 23.6,18.5C23.6,18.9 23.6,19.4 23.7,19.8C19.3,19.6 15.4,17.3 12.8,13.9C12.3,14.7 12.1,15.7 12.1,16.8C12.1,18.8 13,20.5 14.4,21.5C13.5,21.5 12.7,21.2 12,20.8C12,20.8 12,20.9 12,20.9C12,23.6 13.8,25.9 16.2,26.5C15.8,26.6 15.3,26.7 14.8,26.7C14.5,26.7 14.1,26.7 13.8,26.6C14.5,28.9 16.4,30.5 18.7,30.5C16.9,32 14.6,32.9 12.2,32.9C11.8,32.9 11.4,32.9 10.9,32.8C13.2,34.4 16,35.4 19,35.4C28.7,35.4 34,26.8 34,19.3C34,19.1 34,18.8 34,18.6C35.2,17.6 36.1,16.6 36.8,15.4z" fill="#FFFFFF" style="pointer-events:inherit" id="svg_4"></path>
  </g>
</svg>
        <p>Twitter</p>
      </a>
    </li>
    

    
    
    <li>
      <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmarkruler.github.io%2fposts%2fshell%2fminimal-safe-bash-script-template%2f" target="_blank" rel="noopener" aria-label="Share on Facebook" class="share-btn facebook">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 48 48" id="facebook" version="1.1" viewBox="0 0 48 48" xml:space="preserve">
  <circle cx="24" cy="24" fill="#4E71A8" r="24" />
  <path d="M29.9,19.5h-4v-2.6c0-1,0.7-1.2,1.1-1.2c0.5,0,2.8,0,2.8,0v-4.4l-3.9,0c-4.4,0-5.3,3.3-5.3,5.3v2.9h-2.5V24  h2.5c0,5.8,0,12.7,0,12.7h5.3c0,0,0-7,0-12.7h3.6L29.9,19.5z" fill="#FFFFFF" />
</svg>
        <p>Facebook</p>
        </a>
    </li>
    

    
    

    
    

    
    
    <li>
      <a href="mailto:?subject=%ec%9e%84%ec%b0%bd%ec%88%98 - %ec%b5%9c%ec%86%8c%ed%95%9c%ec%9d%98%20%ec%95%88%ec%a0%84%ed%95%9c%20Bash%20%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8%20%ed%85%9c%ed%94%8c%eb%a6%bf.&amp;body=%ec%b5%9c%ec%86%8c%ed%95%9c%ec%9d%98%20%ec%95%88%ec%a0%84%ed%95%9c%20Bash%20%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8%20%ed%85%9c%ed%94%8c%eb%a6%bf%2c%20by%20%ec%9e%84%ec%b0%bd%ec%88%98%0aMaciej%20Radzikowski%0a%0ahttps%3a%2f%2fmarkruler.github.io%2fposts%2fshell%2fminimal-safe-bash-script-template%2f%0a" target="_blank" class="share-btn email">
        <svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" id="email" overflow="hidden">
  <defs></defs>
  <g style="pointer-events:none">
    <title style="pointer-events:inherit">background</title>
    <rect x="-1" y="-1" width="582" height="402" id="canvas_background" fill="none" style="pointer-events:inherit"></rect>
  </g>
  <g style="pointer-events:all">
    <title style="pointer-events:inherit">Layer 1</title>
    <path d="M16,0C7.163,0 0,7.163 0,16C0,24.836 7.163,32 16,32S32,24.836 32,16C32,7.163 24.837,0 16,0z" fill="#333333" style="pointer-events:inherit" id="svg_2"></path>
    <polygon fill="#FFFFFF" points="6.518,21.815 11.707,15.291 6.518,12.119   " style="pointer-events:inherit" id="svg_4"></polygon>
    <polygon fill="#FFFFFF" points="19.5,15.746 15.989,17.908 12.472,15.758 7.11,22.5 24.867,22.5   " style="pointer-events:inherit" id="svg_5"></polygon>
    <polygon fill="#FFFFFF" points="15.988,16.864 25.482,11.017 25.482,9.5 6.518,9.5 6.518,11.076   " style="pointer-events:inherit" id="svg_6"></polygon>
    <polygon fill="#FFFFFF" points="20.263,15.276 25.482,21.843 25.482,12.062   " style="pointer-events:inherit" id="svg_7"></polygon>
  </g>
</svg>
        <p>Email</p>
      </a>
    </li>
  </ul>
</section>


        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://markruler.github.io/">
    
        <div class="nav-title">
            임창수
        </div>
        
        <div class="nav-subtitle">
            What, Why, How.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Posts
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
        <div
            class="read-random a-block nav-link-item false"
            data-target-prefix="/posts">
            Navigate to Random Post
        </div>
    </div>

    <div class="nav-footer">
        


Hugo Theme <a style="color: #0054B8; text-decoration: underline;" href="https://github.com/amazingrise/hugo-theme-diary">Diary</a>
by <a style="color: #0054B8; text-decoration: underline;" href="https://risehere.net/">Rise</a>
<br>
Ported from <a style="color: #0054B8; text-decoration: underline;" href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s
<a style="color: #0054B8; text-decoration: underline;" href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Im Changsu | Since 2020
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 목차 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bash%ec%97%90%ec%84%9c-%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8c%85-%ed%95%98%eb%8a%94-%ec%9d%b4%ec%9c%a0" class="nav-bash에서-스크립팅-하는-이유">
									Bash에서 스크립팅 하는 이유
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bash-%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8-%ed%85%9c%ed%94%8c%eb%a6%bf" class="nav-bash-스크립트-템플릿">
									Bash 스크립트 템플릿
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bash-%ec%84%a0%ed%83%9d%ed%95%98%ea%b8%b0" class="nav-bash-선택하기">
									Bash 선택하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%b9%a0%eb%a5%b4%ea%b2%8c-%ec%8b%a4%ed%8c%a8%ed%95%98%ea%b8%b0" class="nav-빠르게-실패하기">
									빠르게 실패하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%9c%84%ec%b9%98-%ea%b0%80%ec%a0%b8%ec%98%a4%ea%b8%b0" class="nav-위치-가져오기">
									위치 가져오기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%a0%95%eb%a6%ac%ed%95%98%ea%b8%b0" class="nav-정리하기">
									정리하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%8f%84%ec%9b%80%eb%90%98%eb%8a%94-%eb%8f%84%ec%9b%80%eb%a7%90-%ed%91%9c%ec%8b%9c%ed%95%98%ea%b8%b0" class="nav-도움되는-도움말-표시하기">
									도움되는 도움말 표시하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%a0%81%ec%a0%88%ed%95%9c-%eb%a9%94%ec%8b%9c%ec%a7%80-%ec%b6%9c%eb%a0%a5%ed%95%98%ea%b8%b0" class="nav-적절한-메시지-출력하기">
									적절한 메시지 출력하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%aa%a8%eb%93%a0-%ed%8c%8c%eb%9d%bc%eb%af%b8%ed%84%b0-%ed%8c%8c%ec%8b%b1" class="nav-모든-파라미터-파싱">
									모든 파라미터 파싱
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%ed%85%9c%ed%94%8c%eb%a6%bf-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0" class="nav-템플릿-사용하기">
									템플릿 사용하기
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%9d%b4%ec%8b%9d%ec%84%b1-portability" class="nav-이식성-portability">
									이식성 (Portability)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%8d%94-%ec%9d%bd%ec%9d%84-%ea%b1%b0%eb%a6%ac" class="nav-더-읽을-거리">
									더 읽을 거리
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%eb%81%9d%eb%a7%ba%ec%9d%8c" class="nav-끝맺음">
									끝맺음
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8-2020-12-15" class="nav-업데이트-2020-12-15">
									업데이트 2020-12-15
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8-2020-12-16" class="nav-업데이트-2020-12-16">
									업데이트 2020-12-16
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            🔝
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="pagination-action-icon" id="darkModeToggleIcon">
                🌙
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">


Hugo Theme <a style="color: #0054B8; text-decoration: underline;" href="https://github.com/amazingrise/hugo-theme-diary">Diary</a>
by <a style="color: #0054B8; text-decoration: underline;" href="https://risehere.net/">Rise</a>
<br>
Ported from <a style="color: #0054B8; text-decoration: underline;" href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s
<a style="color: #0054B8; text-decoration: underline;" href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Im Changsu | Since 2020
	
</div>
            </div>
    
    <script defer src="/js/journal.js"></script><script defer src="/js/read-random.js"></script>

    <script>
        
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/js/sw.js')
            .then(registration => {
              console.log('Service Worker registered with scope:', registration.scope);
            })
            .catch(error => {
              console.log('Service Worker registration failed:', error);
            });
        }
      </script>
    </body>
</html>
